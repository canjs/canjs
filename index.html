<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<title>CanJS**</title>
<link rel="stylesheet" type="text/css" href="stylesheets/styles.css">
<link rel="stylesheet" type="text/css" href="stylesheets/tango.css">

</head>
<body>
<div id='bg'>
</div>
<div class='cf' id='wrapper'>
	<div id='menu-wrapper'>
		<div id='header'>
			<div id='logo-and-download'>
				<img alt="Logo" id="logo" src="images/logo.png"/>
				<a class='primary' href='#'>Download v3.3.3</a>
			</div>
		</div>
		<div class='cf' id='buttons'>
			<a href='#'>Visit Forums</a>
			<a href='#'>Fork on Github</a>
		</div>
		<ul id='menu'>
		</ul>
		<a href='#' id='developed-by'>
		<img alt="Bitovi" src="images/bitovi.png"/>
		</a>
	</div>
	<div id='content-wrapper'>
		<div id='content'>
			<h1 id='canjs'>CanJS</h1>

<p>This walks through the basics of CanJS by building a smal todo app. Check out the <a href='http://javascriptmvc.com/docs.html#!#getstarted'>Getting Started Guide</a> for a more in-depth overview.</p>

<h2 id='get_canned'>Get Canned</h2>

<h2 id='canconstruct_'>Can.Construct <code>Can.Construct([classProps,] [prototypeProps])</code></h2>

<p>Constructors made with <a href='http://javascriptmvc.com/docs.html#!#Can.Construct'>Can.Construct</a> are used to create objects with shared properties. It&#8217;s used by both <strong>Can.Control</strong> and <strong>Can.Model</strong>.</p>

<p>To create a <strong>Class</strong> of your own, call <strong>Can.Construct</strong> with the:</p>

<ul>
<li><strong>classProperties</strong> that are attached directly to the constructor, and</li>

<li>instance <strong>prototypeProperties</strong>.</li>
</ul>

<p><strong>Can.Construct</strong> sets up the prototype chain so subclasses can be further extended and sub-classed as far as you like:</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>Todo</span> <span class='o'>=</span> <span class='nx'>Can</span><span class='p'>.</span><span class='nx'>Construct</span><span class='p'>({</span>
  <span class='nx'>init</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(){},</span>

  <span class='nx'>author</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(){</span> <span class='p'>...</span> <span class='p'>},</span>

  <span class='nx'>coordinates</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(){</span> <span class='p'>...</span> <span class='p'>},</span>

  <span class='nx'>allowedToEdit</span><span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>account</span><span class='p'>)</span> <span class='p'>{</span> 
   <span class='k'>return</span> <span class='kc'>true</span><span class='p'>;</span>
  <span class='p'>}</span>
<span class='p'>});</span>

 <span class='kd'>var</span> <span class='nx'>PrivateTodo</span> <span class='o'>=</span> <span class='nx'>Todo</span><span class='p'>({</span>
  <span class='nx'>allowedToEdit</span><span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>account</span><span class='p'>)</span> <span class='p'>{</span>
    <span class='k'>return</span> <span class='nx'>account</span><span class='p'>.</span><span class='nx'>owns</span><span class='p'>(</span><span class='k'>this</span><span class='p'>);</span>
  <span class='p'>}</span>
<span class='p'>})</span>
</code></pre>
</div>
<h3 id='init_'>init <code>new Can.Construct(arg1, arg2)</code></h3>

<p>When a class constructor is invoked, <strong>Can.Construct</strong> creates the instance and calls <a href='http://javascriptmvc.com/docs.html#!#Can.Construct.prototype.init'>Can.Construct.prototype.init</a> with the arguments passed to <code>new Class(...)</code>.</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>Todo</span> <span class='o'>=</span> <span class='nx'>Can</span><span class='p'>.</span><span class='nx'>Construct</span><span class='p'>({</span>
  <span class='nx'>init</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>text</span><span class='p'>)</span> <span class='p'>{</span>
    <span class='k'>this</span><span class='p'>.</span><span class='nx'>text</span> <span class='o'>=</span> <span class='nx'>text</span>
  <span class='p'>},</span>
  <span class='nx'>read</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(){</span>
    <span class='nx'>console</span><span class='p'>.</span><span class='nx'>log</span><span class='p'>(</span><span class='k'>this</span><span class='p'>.</span><span class='nx'>text</span><span class='p'>);</span>
  <span class='p'>}</span>
<span class='p'>})</span>

<span class='kd'>var</span> <span class='nx'>todo</span> <span class='o'>=</span> <span class='k'>new</span> <span class='nx'>Todo</span><span class='p'>(</span><span class='s2'>&quot;Hello World&quot;</span><span class='p'>);</span>
<span class='nx'>todo</span><span class='p'>.</span><span class='nx'>read</span><span class='p'>()</span>
</code></pre>
</div>
<h2 id='canmodel_'>Can.Model <code>Can.Model(classProperties, prototypeProperties)</code></h2>

<p>Models are central to any application. They contain data and logic surrounding it. You extend <a href='http://javascriptmvc.com/docs.html#!#Can.Model'>Can.Model</a> with your domain specific methods and Can.Model provides a set of methods for managing changes.</p>

<p>To create a <strong>Model</strong> class, call <strong>Can.Model</strong> with the:</p>

<ul>
<li><strong>classProperties</strong>, including <a href='http://javascriptmvc.com/docs.html#!#Can.Model.findAll'>findAll</a>, <a href='http://javascriptmvc.com/docs.html#!#Can.Model.findAll'>findOne</a>, <a href='http://javascriptmvc.com/docs.html#!#Can.Model.create'>create</a>, <a href='http://javascriptmvc.com/docs.html#!#Can.Model.update'>update</a>, <a href='http://javascriptmvc.com/docs.html#!#Can.Model.destroy'>destroy</a> properties, and</li>

<li>prototype instance properties.</li>
</ul>

<p>Make a Todo model in <strong>todos.js</strong> like the following:</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>Todo</span> <span class='o'>=</span> <span class='nx'>Can</span><span class='p'>.</span><span class='nx'>Model</span><span class='p'>({</span>
  <span class='nx'>findAll</span> <span class='o'>:</span> <span class='s2'>&quot;GET /todos&quot;</span><span class='p'>,</span>
  <span class='nx'>findOne</span> <span class='o'>:</span> <span class='s2'>&quot;GET /todos/{id}&quot;</span><span class='p'>,</span>
  <span class='nx'>create</span>  <span class='o'>:</span> <span class='s2'>&quot;POST /todos&quot;</span><span class='p'>,</span>
  <span class='nx'>update</span>  <span class='o'>:</span> <span class='s2'>&quot;PUT /todos/{id}&quot;</span><span class='p'>,</span>
  <span class='nx'>destroy</span> <span class='o'>:</span> <span class='s2'>&quot;DELETE /todos/{id}&quot;</span>
<span class='p'>},</span>
<span class='p'>{})</span>
</code></pre>
</div>
<p><strong>Note:</strong> Try the following commands in your browser:</p>

<h3 id='new_canmodelattributes'>new Can.Model(attributes)</h3>

<p>Create a todo instance like:</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>todo</span> <span class='o'>=</span> <span class='k'>new</span> <span class='nx'>Todo</span><span class='p'>({</span><span class='nx'>name</span><span class='o'>:</span> <span class='s2'>&quot;do the dishes&quot;</span><span class='p'>});</span>
</code></pre>
</div>
<h3 id='attr_'>attr <code>model.attr( name, [value] )</code></h3>

<p><a href='http://javascriptmvc.com/docs.html#!#Can.Model.prototype.attr'>Can.Model.prototype.attr</a> reads or sets properties on model instances.</p>
<div class='highlight'><pre><code class='javascript'><span class='nx'>todo</span><span class='p'>.</span><span class='nx'>attr</span><span class='p'>(</span><span class='s1'>&#39;name&#39;</span><span class='p'>)</span> <span class='c1'>//-&gt; &quot;do the dishes&quot;</span>

<span class='nx'>todo</span><span class='p'>.</span><span class='nx'>attr</span><span class='p'>(</span><span class='s1'>&#39;name&#39;</span><span class='p'>,</span> <span class='s2'>&quot;wash the dishes&quot;</span> <span class='p'>);</span>

<span class='nx'>todo</span><span class='p'>.</span><span class='nx'>attr</span><span class='p'>()</span> <span class='c1'>//-&gt; {name: &quot;wash the dishes&quot;}</span>

<span class='nx'>todo</span><span class='p'>.</span><span class='nx'>attr</span><span class='p'>({</span><span class='nx'>name</span><span class='o'>:</span> <span class='s2'>&quot;did the dishes&quot;</span><span class='p'>});</span>
</code></pre>
</div>
<h3 id='talking_to_the_server'>Talking to the server</h3>

<p>Model uses static <a href='http://javascriptmvc.com/docs.html#!#Can.Model.findAll'>findAll</a>, <a href='http://javascriptmvc.com/docs.html#!#Can.findAll'>findOne</a>, <a href='http://javascriptmvc.com/docs.html#!#Can.create'>create</a>, <a href='http://javascriptmvc.com/docs.html#!#Can.update'>update</a>, and <a href='http://javascriptmvc.com/docs.html#!#Can.destroy'>destroy</a> methods to create, read, update and delete model instances on the server.</p>

<p>Now you can call methods on Todo that make changes on the server. For example, in your console, try:</p>
<div class='highlight'><pre><code class='javascript'><span class='nx'>Todo</span><span class='p'>.</span><span class='nx'>findAll</span><span class='p'>({});</span>
</code></pre>
</div>
<p>In the console, you&#8217;ll see it make a request to <code>GET /todos</code>.</p>

<h3 id='findall_'>findAll <code>findAll( params, success( todos ), error() )</code></h3>

<p><a href='http://javascriptmvc.com/docs.html#!#Can.Model.findAll'>findAll</a> retrieves multiple todos:</p>
<div class='highlight'><pre><code class='javascript'><span class='nx'>Todo</span><span class='p'>.</span><span class='nx'>findAll</span><span class='p'>({},</span> <span class='kd'>function</span><span class='p'>(</span> <span class='nx'>todos</span> <span class='p'>)</span> <span class='p'>{</span>
  <span class='nx'>console</span><span class='p'>.</span><span class='nx'>log</span><span class='p'>(</span> <span class='nx'>todos</span> <span class='p'>);</span>
<span class='p'>})</span>
</code></pre>
</div>
<h3 id='findone_'>findOne <code>findOne( params, success( todo ), error() )</code></h3>

<p><a href='http://javascriptmvc.com/docs.html#!#Can.Model.findOne'>findOne</a> retrieves a single todo:</p>
<div class='highlight'><pre><code class='javascript'><span class='nx'>Todo</span><span class='p'>.</span><span class='nx'>findOne</span><span class='p'>({},</span> <span class='kd'>function</span><span class='p'>(</span> <span class='nx'>todo</span> <span class='p'>)</span> <span class='p'>{</span>
  <span class='nx'>console</span><span class='p'>.</span><span class='nx'>log</span><span class='p'>(</span> <span class='nx'>todo</span> <span class='p'>);</span>
<span class='p'>})</span>
</code></pre>
</div>
<h3 id='save_'>save <code>todo.save( success( todo ), error() )</code></h3>

<p><a href='http://javascriptmvc.com/docs.html#!#$.Model::save'>Save</a> can <strong>create</strong> or <strong>update</strong> instances depending if the instance has already been created or not.</p>

<p>To <strong>create</strong> a todo on the server, create a todo instance and call <strong>save</strong> like the following:</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>todo</span> <span class='o'>=</span> <span class='k'>new</span> <span class='nx'>Todo</span><span class='p'>({</span><span class='nx'>name</span><span class='o'>:</span> <span class='s2'>&quot;mow lawn&quot;</span><span class='p'>})</span>
<span class='nx'>todo</span><span class='p'>.</span><span class='nx'>save</span><span class='p'>(</span><span class='kd'>function</span><span class='p'>(</span><span class='nx'>todo</span><span class='p'>){</span>
  <span class='nx'>console</span><span class='p'>.</span><span class='nx'>log</span><span class='p'>(</span> <span class='nx'>todo</span> <span class='p'>);</span>
<span class='p'>})</span>
</code></pre>
</div>
<p>To <strong>update</strong> a todo on the server, change the attributes and call <strong>save</strong> again like the following:</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>todo</span> <span class='o'>=</span> <span class='k'>new</span> <span class='nx'>Todo</span><span class='p'>({</span><span class='nx'>name</span><span class='o'>:</span> <span class='s2'>&quot;mow lawn&quot;</span><span class='p'>});</span>
<span class='nx'>todo</span><span class='p'>.</span><span class='nx'>save</span><span class='p'>(</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>todo</span><span class='p'>){</span>
  <span class='nx'>console</span><span class='p'>.</span><span class='nx'>log</span><span class='p'>(</span><span class='s2'>&quot;created&quot;</span><span class='p'>,</span> <span class='nx'>todo</span> <span class='p'>);</span>
  
  <span class='nx'>todo</span><span class='p'>.</span><span class='nx'>attr</span><span class='p'>(</span><span class='s2'>&quot;name&quot;</span><span class='p'>,</span> <span class='s2'>&quot;mow my lawn&quot;</span><span class='p'>)</span>
  <span class='nx'>todo</span><span class='p'>.</span><span class='nx'>save</span><span class='p'>(</span> <span class='kd'>function</span><span class='p'>(</span> <span class='nx'>todo</span> <span class='p'>)</span> <span class='p'>{</span>
    <span class='nx'>console</span><span class='p'>.</span><span class='nx'>log</span><span class='p'>(</span><span class='s2'>&quot;updated&quot;</span><span class='p'>,</span> <span class='nx'>todo</span> <span class='p'>);</span>
  <span class='p'>})</span>
<span class='p'>})</span>
</code></pre>
</div>
<h3 id='destroy_'>destroy <code>todo.destroy( success( todo ), error() )</code></h3>

<p><a href='http://javascriptmvc.com/docs.html#!#Can.Model.prototype.destroy'>Destroy</a> deletes a record on the server. You can do this like:</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>todo</span> <span class='o'>=</span> <span class='k'>new</span> <span class='nx'>Todo</span><span class='p'>({</span><span class='nx'>name</span><span class='o'>:</span> <span class='s2'>&quot;mow lawn&quot;</span><span class='p'>});</span>
<span class='nx'>todo</span><span class='p'>.</span><span class='nx'>save</span><span class='p'>(</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>todo</span><span class='p'>){</span>
  <span class='nx'>console</span><span class='p'>.</span><span class='nx'>log</span><span class='p'>(</span><span class='s2'>&quot;created&quot;</span><span class='p'>,</span> <span class='nx'>todo</span> <span class='p'>);</span>
  
  <span class='nx'>todo</span><span class='p'>.</span><span class='nx'>destroy</span><span class='p'>(</span> <span class='kd'>function</span><span class='p'>(</span> <span class='nx'>todo</span> <span class='p'>)</span> <span class='p'>{</span>
    <span class='nx'>console</span><span class='p'>.</span><span class='nx'>log</span><span class='p'>(</span><span class='s2'>&quot;destroyed&quot;</span><span class='p'>,</span> <span class='nx'>todo</span> <span class='p'>);</span>
  <span class='p'>})</span>
<span class='p'>})</span>
</code></pre>
</div>
<h3 id='bind_'>bind <code>todo.bind( event, handler(ev, todo ) )</code></h3>

<p>Listening to changes in the Model is what MVC is about. Model lets you <a href='http://javascriptmvc.com/docs.html#!#Can.Model::bind'>bind</a> to changes on an individual instance or <a href='http://javascriptmvc.com/docs.html#!#Can.Model.bind'>all instances</a>. For example, you can listen to when an instance is <strong>created</strong> on the server like:</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>todo</span> <span class='o'>=</span> <span class='k'>new</span> <span class='nx'>Todo</span><span class='p'>({</span><span class='nx'>name</span><span class='o'>:</span> <span class='s2'>&quot;mow lawn&quot;</span><span class='p'>});</span>
<span class='nx'>todo</span><span class='p'>.</span><span class='nx'>bind</span><span class='p'>(</span><span class='s1'>&#39;created&#39;</span><span class='p'>,</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>ev</span><span class='p'>,</span> <span class='nx'>todo</span><span class='p'>){</span>
  <span class='nx'>console</span><span class='p'>.</span><span class='nx'>log</span><span class='p'>(</span><span class='s2'>&quot;created&quot;</span><span class='p'>,</span> <span class='nx'>todo</span> <span class='p'>);</span>
<span class='p'>})</span>
<span class='nx'>todo</span><span class='p'>.</span><span class='nx'>save</span><span class='p'>()</span>
</code></pre>
</div>
<p>You can listen to anytime an <strong>instance</strong> is created on the server by binding on the model:</p>
<div class='highlight'><pre><code class='javascript'><span class='nx'>Todo</span><span class='p'>.</span><span class='nx'>bind</span><span class='p'>(</span><span class='s1'>&#39;created&#39;</span><span class='p'>,</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>ev</span><span class='p'>,</span> <span class='nx'>todo</span><span class='p'>){</span>
  <span class='nx'>console</span><span class='p'>.</span><span class='nx'>log</span><span class='p'>(</span><span class='s2'>&quot;created&quot;</span><span class='p'>,</span> <span class='nx'>todo</span> <span class='p'>);</span>
<span class='p'>})</span>
</code></pre>
</div>
<p>Model produces the following events on the model class and instances whenever a model Ajax request completes:</p>

<ul>
<li><strong>created</strong> - an instance is created on the server</li>

<li><strong>updated</strong> - an instance is updated on the server</li>

<li><strong>destroyed</strong> - an instance is destroyed on the server</li>
</ul>

<h2 id='canview_'>Can.View <code>Can.View( idOrUrl, data )</code></h2>

<p><a href='http://javascriptmvc.com/docs.html#!#Can.View'>Can.View</a> is used to easily create HTML with JS templates. Pass it &#8230;</p>

<ul>
<li>the <strong>id</strong> of a script tag to use as the content of the template</li>

<li><strong>data</strong> to pass to the template</li>
</ul>

<p>&#8230; and it returns the rendered result of the template. For example, add the following to <strong>todos.html</strong>:</p>
<div class='highlight'><pre><code class='html'><span class='nt'>&lt;script </span><span class='na'>type=</span><span class='s'>&#39;text/ejs&#39;</span> <span class='na'>id=</span><span class='s'>&#39;todosEJS&#39;</span><span class='nt'>&gt;</span>
  <span class='o'>&lt;%</span> <span class='k'>for</span><span class='p'>(</span><span class='kd'>var</span> <span class='nx'>i</span> <span class='o'>=</span> <span class='mi'>0</span><span class='p'>;</span> <span class='nx'>i</span> <span class='o'>&lt;</span> <span class='k'>this</span><span class='p'>.</span><span class='nx'>length</span><span class='p'>;</span> <span class='nx'>i</span><span class='o'>++</span> <span class='p'>){</span> <span class='o'>%&gt;</span>
    <span class='o'>&lt;</span><span class='nx'>li</span><span class='o'>&gt;&lt;%=</span> <span class='k'>this</span><span class='p'>[</span><span class='nx'>i</span><span class='p'>].</span><span class='nx'>name</span> <span class='o'>%&gt;&lt;</span><span class='err'>/li&gt;</span>
  <span class='o'>&lt;%</span> <span class='p'>}</span> <span class='o'>%&gt;</span>
<span class='nt'>&lt;/script&gt;</span>
</code></pre>
</div>
<p>Render a list of todos with:</p>
<div class='highlight'><pre><code class='javascript'><span class='nx'>Todo</span><span class='p'>.</span><span class='nx'>findAll</span><span class='p'>(</span> <span class='p'>{},</span> <span class='kd'>function</span><span class='p'>(</span> <span class='nx'>todos</span> <span class='p'>){</span>
   <span class='nx'>console</span><span class='p'>.</span><span class='nx'>log</span><span class='p'>(</span> <span class='nx'>$</span><span class='p'>.</span><span class='nx'>View</span><span class='p'>(</span> <span class='s1'>&#39;todosEJS&#39;</span><span class='p'>,</span> <span class='nx'>todos</span> <span class='p'>)</span> <span class='p'>);</span>
<span class='p'>});</span>
</code></pre>
</div>
<p>Can.View also takes a <strong>url</strong> for a template location. <strong>Create</strong> a <em>todos/todos.ejs</em> file that contains the following:</p>

<p>Render this with:</p>
<div class='highlight'><pre><code class='javascript'><span class='nx'>Todo</span><span class='p'>.</span><span class='nx'>findAll</span><span class='p'>(</span> <span class='p'>{},</span> <span class='kd'>function</span><span class='p'>(</span> <span class='nx'>todos</span> <span class='p'>){</span>
  <span class='nx'>console</span><span class='p'>.</span><span class='nx'>log</span><span class='p'>(</span> <span class='nx'>$</span><span class='p'>.</span><span class='nx'>View</span><span class='p'>(</span> <span class='s1'>&#39;todos.ejs&#39;</span><span class='p'>,</span> <span class='nx'>todos</span> <span class='p'>)</span> <span class='p'>);</span>
<span class='p'>});</span>
</code></pre>
</div>
<p><strong>Can.View</strong> works with any template language, such as JAML, jQuery-tmpl, Mustache and superpowers them with:</p>

<ul>
<li>Loading from scripts and external files</li>

<li>using templates with jQuery <strong>modifiers</strong> like html</li>

<li>Template caching</li>

<li>Deferred support</li>

<li>Bundling processed templates in production builds</li>
</ul>

<h3 id='modifiers_'>Modifiers <code>el.&lt;i&gt;modifier&lt;/i&gt;( idOrUrl, data )</code></h3>

<p><strong>Can.View</strong> overwrites the jQuery&#8217;s html modifiers after, append, before, html, prepend, replaceWith, and text, allowing you to write:</p>
<div class='highlight'><pre><code class='javascript'><span class='nx'>Todo</span><span class='p'>.</span><span class='nx'>findAll</span><span class='p'>(</span> <span class='p'>{},</span> <span class='kd'>function</span><span class='p'>(</span> <span class='nx'>todos</span> <span class='p'>){</span>
  <span class='nx'>$</span><span class='p'>(</span><span class='s1'>&#39;#todos&#39;</span><span class='p'>).</span><span class='nx'>html</span><span class='p'>(</span> <span class='s1'>&#39;todos.ejs&#39;</span><span class='p'>,</span> <span class='nx'>todos</span> <span class='p'>);</span>
<span class='p'>});</span>
</code></pre>
</div>
<p>To make this work, make sure <code>todos.html</code> has a <code>#todos</code> element like:</p>
<div class='highlight'><pre><code class='html'><span class='nt'>&lt;ul</span> <span class='na'>id=</span><span class='s'>&#39;todos&#39;</span><span class='nt'>&gt;&lt;/ul&gt;</span>
</code></pre>
</div>
<h3 id='deferreds'>Deferreds</h3>

<p><strong>Can.Model</strong>&#8217;s ajax methods return a deffered. <strong>Can.View</strong> accepts deferreds, making this hotness possible:</p>
<div class='highlight'><pre><code class='javascript'><span class='nx'>$</span><span class='p'>(</span><span class='s1'>&#39;#todos&#39;</span><span class='p'>).</span><span class='nx'>html</span><span class='p'>(</span><span class='s1'>&#39;todos.ejs&#39;</span><span class='p'>,</span> <span class='nx'>Todo</span><span class='p'>.</span><span class='nx'>findAll</span><span class='p'>()</span> <span class='p'>)</span>
</code></pre>
</div>
<p>This syntax will render todos.ejs with the todo instances in the AJAX request made by Todo.findAll, whenever its completed.</p>

<h2 id='cancontrol_'>Can.Control <code>Can.Control(classProps, prototypeProps)</code></h2>

<p><a href='http://javascriptmvc.com/docs.html#!#Can.Control'>Can.Control</a> creates organized, memory-leak free, rapidly performing, stateful widgets. It is used to create UI controls like tabs, grids, and contextmenus and used to organize them into higher-order business rules with <a href='http://javascriptmvc.com/docs.html#!#Can.route'>Can.route</a>. Its serves as both a traditional view and a traditional controller.</p>

<p>Let&#8217;s make a basic todos widget that lists todos and lets us destroy them. Add the following to <strong>todos.js</strong>:</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>Todos</span> <span class='o'>=</span> <span class='nx'>Can</span><span class='p'>.</span><span class='nx'>Control</span><span class='p'>({</span>
  <span class='s2'>&quot;init&quot;</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span> <span class='nx'>element</span> <span class='p'>,</span> <span class='nx'>options</span> <span class='p'>){</span>
    <span class='k'>this</span><span class='p'>.</span><span class='nx'>element</span><span class='p'>.</span><span class='nx'>html</span><span class='p'>(</span><span class='s1'>&#39;todos.ejs&#39;</span><span class='p'>,</span> <span class='nx'>Todo</span><span class='p'>.</span><span class='nx'>findAll</span><span class='p'>()</span> <span class='p'>)</span>
  <span class='p'>}</span>
<span class='p'>})</span>
</code></pre>
</div>
<p>We can create this widget on the <code>#todos</code> element with:</p>
<div class='highlight'><pre><code class='javascript'><span class='k'>new</span> <span class='nx'>Todos</span><span class='p'>(</span><span class='s1'>&#39;#todos&#39;</span><span class='p'>,</span> <span class='p'>{});</span>
</code></pre>
</div>
<h3 id='init_'>init <code>Can.Control.prototype.init(element, options)</code></h3>

<p><a href='http://javascriptmvc.com/docs.html#!#Can.Control:init'>Init</a> is called when a new Can.Control instance is created. It&#8217;s called with:</p>

<ul>
<li><strong>element</strong> - The jQuery wrapped element passed to the controller. Controller accepts a jQuery element, a raw HTMLElement, or a css selector. This is set as <strong>this.element</strong> on the controller instance.</li>

<li><strong>options</strong> - The second argument passed to new Controller, extended with the Can.Control&#8217;s static <strong>defaults</strong>. This is set as <strong>this.options</strong> on the controller instance.</li>
</ul>

<p>and any other arguments passed to <code>new Can.Control()</code>. For example:</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>Todos</span> <span class='o'>=</span> <span class='nx'>$</span><span class='p'>.</span><span class='nx'>Controller</span><span class='p'>({</span>
  <span class='nx'>defaults</span> <span class='o'>:</span> <span class='p'>{</span><span class='nx'>template</span><span class='o'>:</span> <span class='s1'>&#39;todos.ejs&#39;</span><span class='p'>}</span>
<span class='p'>},{</span>
  <span class='s2'>&quot;init&quot;</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span> <span class='nx'>element</span> <span class='p'>,</span> <span class='nx'>options</span> <span class='p'>){</span>
    <span class='nx'>element</span><span class='p'>.</span><span class='nx'>html</span><span class='p'>(</span><span class='nx'>options</span><span class='p'>.</span><span class='nx'>template</span><span class='p'>,</span> <span class='nx'>Todo</span><span class='p'>.</span><span class='nx'>findAll</span><span class='p'>()</span> <span class='p'>)</span>
  <span class='p'>}</span>
<span class='p'>})</span>

<span class='k'>new</span> <span class='nx'>Todos</span><span class='p'>(</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>body</span><span class='p'>.</span><span class='nx'>firstElementChild</span> <span class='p'>);</span>
<span class='k'>new</span> <span class='nx'>Todos</span><span class='p'>(</span> <span class='nx'>$</span><span class='p'>(</span><span class='s1'>&#39;#todos&#39;</span><span class='p'>),</span> <span class='p'>{</span><span class='nx'>template</span><span class='o'>:</span> <span class='s1'>&#39;specialTodos.ejs&#39;</span><span class='p'>})</span>
</code></pre>
</div>
<h3 id='element_'>element <code>this.element</code></h3>

<p><a href='http://javascriptmvc.com/docs.html#!#Can.Controll.prototype.element'>this.element</a> is the element the controller is created on.</p>

<h3 id='options_'>options <code>this.options</code></h3>

<p><a href='http://javascriptmvc.com/docs.html#!#Can.Control.prototype.options'>this.options</a> is the second argument passed to <code>new Can.Control()</code> merged with the controller&#8217;s static <strong>defaults</strong> property.</p>

<h3 id='listening_to_events'>Listening to events</h3>

<p>Controller automatically binds prototype methods that look like event handlers. Listen to <strong>click</strong>s on <code>&lt;li&gt;</code> elements like:</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>Todos</span> <span class='o'>=</span> <span class='nx'>Can</span><span class='p'>.</span><span class='nx'>Control</span><span class='p'>({</span>
  <span class='s2'>&quot;init&quot;</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span> <span class='nx'>element</span> <span class='p'>,</span> <span class='nx'>options</span> <span class='p'>){</span>
    <span class='k'>this</span><span class='p'>.</span><span class='nx'>element</span><span class='p'>.</span><span class='nx'>html</span><span class='p'>(</span><span class='s1'>&#39;todos.ejs&#39;</span><span class='p'>,</span> <span class='nx'>Todo</span><span class='p'>.</span><span class='nx'>findAll</span><span class='p'>()</span> <span class='p'>)</span>
  <span class='p'>},</span>
  <span class='s2'>&quot;li click&quot;</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>li</span><span class='p'>,</span> <span class='nx'>event</span><span class='p'>){</span>
    <span class='nx'>console</span><span class='p'>.</span><span class='nx'>log</span><span class='p'>(</span><span class='s2'>&quot;You clicked&quot;</span><span class='p'>,</span> <span class='nx'>li</span><span class='p'>.</span><span class='nx'>text</span><span class='p'>()</span> <span class='p'>)</span>
    
    <span class='c1'>// let other controls know what happened</span>
    <span class='nx'>li</span><span class='p'>.</span><span class='nx'>trigger</span><span class='p'>(</span><span class='s1'>&#39;selected&#39;</span><span class='p'>);</span>
  <span class='p'>}</span>
<span class='p'>})</span>
</code></pre>
</div>
<p>When an <code>&lt;li&gt;</code> is clicked, <code>&quot;li click&quot;</code> is called with:</p>

<ul>
<li>The jQuery-wrapped <strong>element</strong> that was clicked</li>

<li>The <strong>event</strong> data</li>
</ul>

<p>Controller uses event delegation, so you can add <code>&lt;li&gt;</code>s without needing to rebind event handlers.</p>

<p>To destroy a todo when it&#8217;s <code>&lt;a href=&#39;javascript:// class=&#39;destroy&#39;&gt;</code> link is clicked:</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>Todos</span> <span class='o'>=</span> <span class='nx'>Can</span><span class='p'>.</span><span class='nx'>Control</span><span class='p'>({</span>
  <span class='s2'>&quot;init&quot;</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span> <span class='nx'>element</span> <span class='p'>,</span> <span class='nx'>options</span> <span class='p'>){</span>
    <span class='k'>this</span><span class='p'>.</span><span class='nx'>element</span><span class='p'>.</span><span class='nx'>html</span><span class='p'>(</span><span class='s1'>&#39;todos.ejs&#39;</span><span class='p'>,</span> <span class='nx'>Todo</span><span class='p'>.</span><span class='nx'>findAll</span><span class='p'>()</span> <span class='p'>)</span>
  <span class='p'>},</span>
  <span class='s2'>&quot;li click&quot;</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>li</span><span class='p'>){</span>
    <span class='nx'>li</span><span class='p'>.</span><span class='nx'>trigger</span><span class='p'>(</span><span class='s1'>&#39;selected&#39;</span><span class='p'>,</span> <span class='nx'>li</span><span class='p'>.</span><span class='nx'>model</span><span class='p'>()</span> <span class='p'>);</span>
  <span class='p'>},</span>
  <span class='s2'>&quot;li .destroy click&quot;</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>el</span><span class='p'>,</span> <span class='nx'>ev</span><span class='p'>){</span>
    <span class='c1'>// get the li element that has the model</span>
    <span class='kd'>var</span> <span class='nx'>li</span> <span class='o'>=</span> <span class='nx'>el</span><span class='p'>.</span><span class='nx'>closest</span><span class='p'>(</span><span class='s1'>&#39;.todo&#39;</span><span class='p'>);</span>
    
    <span class='c1'>// get the model</span>
    <span class='kd'>var</span> <span class='nx'>todo</span> <span class='o'>=</span> <span class='nx'>li</span><span class='p'>.</span><span class='nx'>model</span><span class='p'>()</span>
    
    <span class='c1'>//destroy it</span>
    <span class='nx'>todo</span><span class='p'>.</span><span class='nx'>destroy</span><span class='p'>(</span><span class='kd'>function</span><span class='p'>(){</span>
      <span class='c1'>// remove the element</span>
      <span class='nx'>li</span><span class='p'>.</span><span class='nx'>remove</span><span class='p'>();</span>
    <span class='p'>});</span>
  <span class='p'>}</span>
<span class='p'>})</span>
</code></pre>
</div>
<h3 id='templated_event_handlers_pt_1_'>Templated Event Handlers Pt 1 <code>&quot;{optionName}&quot;</code></h3>

<p>Customize event handler behavior with <code>&quot;{NAME}&quot;</code> in the event handler name. The following allows customization of the event that destroys a todo:</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>Todos</span> <span class='o'>=</span> <span class='nx'>Can</span><span class='p'>.</span><span class='nx'>Control</span><span class='p'>(</span><span class='s2'>&quot;Todos&quot;</span><span class='p'>,{</span>
  <span class='s2'>&quot;init&quot;</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span> <span class='nx'>element</span> <span class='p'>,</span> <span class='nx'>options</span> <span class='p'>){</span> <span class='p'>...</span> <span class='p'>},</span>
  <span class='s2'>&quot;li click&quot;</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>li</span><span class='p'>){</span> <span class='p'>...</span> <span class='p'>},</span>
  
  <span class='s2'>&quot;li .destroy {destroyEvent}&quot;</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>el</span><span class='p'>,</span> <span class='nx'>ev</span><span class='p'>){</span> 
    <span class='c1'>// previous destroy code here</span>
  <span class='p'>}</span>
<span class='p'>})</span>

<span class='c1'>// create Todos with this.options.destroyEvent</span>
<span class='k'>new</span> <span class='nx'>Todos</span><span class='p'>(</span><span class='s2'>&quot;#todos&quot;</span><span class='p'>,{</span><span class='nx'>destroyEvent</span><span class='o'>:</span> <span class='s2'>&quot;mouseenter&quot;</span><span class='p'>})</span>
</code></pre>
</div>
<p>Values inside <code>{NAME}</code> are looked up on the controller&#8217;s <code>this.options</code> and then the <code>window</code>. For example, we could customize it instead like:</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>Todos</span> <span class='o'>=</span> <span class='nx'>Can</span><span class='p'>.</span><span class='nx'>Control</span><span class='p'>(</span><span class='s2'>&quot;Todos&quot;</span><span class='p'>,{</span>
  <span class='s2'>&quot;init&quot;</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span> <span class='nx'>element</span> <span class='p'>,</span> <span class='nx'>options</span> <span class='p'>){</span> <span class='p'>...</span> <span class='p'>},</span>
  <span class='s2'>&quot;li click&quot;</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>li</span><span class='p'>){</span> <span class='p'>...</span> <span class='p'>},</span>
  
  <span class='s2'>&quot;li .destroy {Events.destroy}&quot;</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>el</span><span class='p'>,</span> <span class='nx'>ev</span><span class='p'>){</span> 
    <span class='c1'>// previous destroy code here</span>
  <span class='p'>}</span>
<span class='p'>})</span>

<span class='c1'>// Events config</span>
<span class='nx'>Events</span> <span class='o'>=</span> <span class='p'>{</span><span class='nx'>destroy</span><span class='o'>:</span> <span class='s2'>&quot;click&quot;</span><span class='p'>};</span>

<span class='c1'>// Events.destroy is looked up on the window.</span>
<span class='k'>new</span> <span class='nx'>Todos</span><span class='p'>(</span><span class='s2'>&quot;#todos&quot;</span><span class='p'>)</span>
</code></pre>
</div>
<p>The selector can also be templated.</p>

<h3 id='templated_event_handlers_pt_2_'>Templated Event Handlers Pt 2 <code>&quot;{objectName}&quot;</code></h3>

<p>Controller can also bind to objects other than <code>this.element</code> with templated event handlers. This is <strong>especially critical</strong> for avoiding memory leaks that are so common among MVC applications.</p>

<p>If the value inside <code>{NAME}</code> is an object, that object will be bound to. For example, the following tooltip listens to clicks on the window:</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>Tooltip</span><span class='p'>({</span>
  <span class='s2'>&quot;{window} click&quot;</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>el</span><span class='p'>,</span> <span class='nx'>ev</span><span class='p'>){</span>
    <span class='c1'>// hide only if we clicked outside the tooltip</span>
    <span class='k'>if</span><span class='p'>(</span><span class='o'>!</span> <span class='k'>this</span><span class='p'>.</span><span class='nx'>element</span><span class='p'>.</span><span class='nx'>has</span><span class='p'>(</span><span class='nx'>ev</span><span class='p'>.</span><span class='nx'>target</span> <span class='p'>)</span> <span class='p'>{</span>
      <span class='k'>this</span><span class='p'>.</span><span class='nx'>element</span><span class='p'>.</span><span class='nx'>remove</span><span class='p'>();</span>
    <span class='p'>}</span>
  <span class='p'>}</span>
<span class='p'>})</span>

<span class='c1'>// create a Tooltip</span>
<span class='k'>new</span> <span class='nx'>Tooltip</span><span class='p'>(</span> <span class='nx'>$</span><span class='p'>(</span><span class='s1'>&#39;&lt;div&gt;INFO&lt;/div&gt;&#39;</span><span class='p'>).</span><span class='nx'>appendTo</span><span class='p'>(</span><span class='nx'>el</span><span class='p'>)</span> <span class='p'>)</span>
</code></pre>
</div>
<p>This is convenient when needing to listen to model updates. Instead of adding a callback to <code>todo.destroy(cb)</code>, we should be listening to <strong>destroyed</strong> events. We&#8217;ll handle <strong>updated</strong> too:</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>Todos</span> <span class='o'>=</span> <span class='nx'>Can</span><span class='p'>.</span><span class='nx'>Control</span><span class='p'>({</span>
  <span class='s2'>&quot;init&quot;</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span> <span class='nx'>element</span> <span class='p'>,</span> <span class='nx'>options</span> <span class='p'>){</span>
    <span class='k'>this</span><span class='p'>.</span><span class='nx'>element</span><span class='p'>.</span><span class='nx'>html</span><span class='p'>(</span><span class='s1'>&#39;todos.ejs&#39;</span><span class='p'>,</span> <span class='nx'>Todo</span><span class='p'>.</span><span class='nx'>findAll</span><span class='p'>()</span> <span class='p'>)</span>
  <span class='p'>},</span>
  <span class='s2'>&quot;li click&quot;</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>li</span><span class='p'>){</span>
    <span class='nx'>li</span><span class='p'>.</span><span class='nx'>trigger</span><span class='p'>(</span><span class='s1'>&#39;selected&#39;</span><span class='p'>,</span> <span class='nx'>li</span><span class='p'>.</span><span class='nx'>model</span><span class='p'>()</span> <span class='p'>);</span>
  <span class='p'>},</span>
  <span class='s2'>&quot;li .destroy click&quot;</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>el</span><span class='p'>,</span> <span class='nx'>ev</span><span class='p'>){</span>
    <span class='nx'>el</span><span class='p'>.</span><span class='nx'>closest</span><span class='p'>(</span><span class='s1'>&#39;.todo&#39;</span><span class='p'>)</span>
      <span class='p'>.</span><span class='nx'>model</span><span class='p'>()</span>
      <span class='p'>.</span><span class='nx'>destroy</span><span class='p'>();</span>
    <span class='nx'>ev</span><span class='p'>.</span><span class='nx'>stopPropagation</span><span class='p'>();</span>
  <span class='p'>},</span>
  <span class='s2'>&quot;{Todo} destroyed&quot;</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>Todo</span><span class='p'>,</span> <span class='nx'>ev</span><span class='p'>,</span> <span class='nx'>destroyedTodo</span><span class='p'>){</span>
    <span class='nx'>destroyedTodo</span><span class='p'>.</span><span class='nx'>elements</span><span class='p'>(</span><span class='k'>this</span><span class='p'>.</span><span class='nx'>element</span><span class='p'>)</span>
                 <span class='p'>.</span><span class='nx'>remove</span><span class='p'>();</span>
  <span class='p'>},</span>
  <span class='s2'>&quot;{Todo} updated&quot;</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>Todo</span><span class='p'>,</span> <span class='nx'>ev</span><span class='p'>,</span> <span class='nx'>updatedTodo</span><span class='p'>){</span>
    <span class='nx'>updatedTodo</span><span class='p'>.</span><span class='nx'>elements</span><span class='p'>(</span><span class='k'>this</span><span class='p'>.</span><span class='nx'>element</span><span class='p'>)</span>
               <span class='p'>.</span><span class='nx'>replaceWith</span><span class='p'>(</span><span class='s1'>&#39;todos.ejs&#39;</span><span class='p'>,[</span><span class='nx'>updatedTodo</span><span class='p'>]);</span>
  <span class='p'>}</span>
<span class='p'>})</span>

<span class='k'>new</span> <span class='nx'>Todos</span><span class='p'>(</span><span class='s2'>&quot;#todos&quot;</span><span class='p'>);</span>
</code></pre>
</div>
<p>This is better because it removes the todo&#8217;s element from the page even if another widget destroyed the todo. Also, this works very well with real-time architectures.</p>

<h3 id='destroy_'>destroy <code>controller.destroy()</code></h3>

<p><a href='http://javascriptmvc.com/docs.html#!#Can.Control.prototype.destroy'>Can.Control.prototype.destroy</a> unbinds a controller&#8217;s event handlers and releases its element, but does not remove the element from the page.</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>todo</span> <span class='o'>=</span> <span class='k'>new</span> <span class='nx'>Todos</span><span class='p'>(</span><span class='s2'>&quot;#todos&quot;</span><span class='p'>)</span>
<span class='nx'>todo</span><span class='p'>.</span><span class='nx'>destroy</span><span class='p'>();</span>
</code></pre>
</div>
<p>When a controller&#8217;s element is removed from the page <strong>destroy</strong> is called automatically.</p>
<div class='highlight'><pre><code class='javascript'><span class='k'>new</span> <span class='nx'>Todos</span><span class='p'>(</span><span class='s2'>&quot;#todos&quot;</span><span class='p'>)</span>
<span class='nx'>$</span><span class='p'>(</span><span class='s2'>&quot;#todos&quot;</span><span class='p'>).</span><span class='nx'>remove</span><span class='p'>();</span>
</code></pre>
</div>
<p>All event handlers bound with Controller are unbound when the controller is destroyed (or its element is removed).</p>

<p><em>Brief aside on destroy and templated event binding. Taken together, templated event binding, and controller&#8217;s automatic clean-up make it almost impossible to write leaking applications. An application that uses only templated event handlers on controllers within the body could free up all data by calling <code>$(document.body).empty()</code>.</em></p>

<h3 id='update_'>update <code>controller.update(options)</code></h3>

<p><a href='http://javascriptmvc.com/docs.html#!#Can.Control.prototype.update'>Can.Control.prototype.update</a> updates a controller&#8217;s <code>this.options</code> and rebinds all event handlers.This is useful when you want to listen to a specific model:</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>Editor</span> <span class='o'>=</span> <span class='nx'>$</span><span class='p'>.</span><span class='nx'>Controller</span><span class='p'>({</span>
  <span class='nx'>update</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>options</span><span class='p'>){</span>
    <span class='k'>this</span><span class='p'>.</span><span class='nx'>_super</span><span class='p'>(</span><span class='nx'>options</span><span class='p'>)</span>
    <span class='k'>this</span><span class='p'>.</span><span class='nx'>setName</span><span class='p'>();</span>
  <span class='p'>},</span>
  <span class='c1'>// a helper that sets the value of the input</span>
  <span class='c1'>// to the todo&#39;s name</span>
  <span class='nx'>setName</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(){</span>
    <span class='k'>this</span><span class='p'>.</span><span class='nx'>element</span><span class='p'>.</span><span class='nx'>val</span><span class='p'>(</span><span class='k'>this</span><span class='p'>.</span><span class='nx'>options</span><span class='p'>.</span><span class='nx'>todo</span><span class='p'>.</span><span class='nx'>name</span><span class='p'>);</span>
  <span class='p'>},</span>
  <span class='c1'>// listen for changes in the todo</span>
  <span class='c1'>// and update the input</span>
  <span class='s2'>&quot;{todo} updated&quot;</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(){</span>
    <span class='k'>this</span><span class='p'>.</span><span class='nx'>setName</span><span class='p'>();</span>
  <span class='p'>},</span>
  <span class='c1'>// when the input changes</span>
  <span class='c1'>// update the todo instance</span>
  <span class='s2'>&quot;change&quot;</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(){</span>
    <span class='kd'>var</span> <span class='nx'>todo</span> <span class='o'>=</span> <span class='k'>this</span><span class='p'>.</span><span class='nx'>options</span><span class='p'>.</span><span class='nx'>todo</span>
    <span class='nx'>todo</span><span class='p'>.</span><span class='nx'>attr</span><span class='p'>(</span><span class='s1'>&#39;name&#39;</span><span class='p'>,</span><span class='k'>this</span><span class='p'>.</span><span class='nx'>element</span><span class='p'>.</span><span class='nx'>val</span><span class='p'>()</span> <span class='p'>)</span>
    <span class='nx'>todo</span><span class='p'>.</span><span class='nx'>save</span><span class='p'>();</span>
  <span class='p'>}</span>
<span class='p'>});</span>

<span class='kd'>var</span> <span class='nx'>todo1</span> <span class='o'>=</span> <span class='k'>new</span> <span class='nx'>Todo</span><span class='p'>({</span><span class='nx'>id</span><span class='o'>:</span> <span class='mi'>6</span><span class='p'>,</span> <span class='nx'>name</span><span class='o'>:</span> <span class='s2'>&quot;trash&quot;</span><span class='p'>}),</span>
    <span class='nx'>todo2</span> <span class='o'>=</span> <span class='k'>new</span> <span class='nx'>Todo</span><span class='p'>({</span><span class='nx'>id</span><span class='o'>:</span> <span class='mi'>6</span><span class='p'>,</span> <span class='nx'>name</span><span class='o'>:</span> <span class='s2'>&quot;dishes&quot;</span><span class='p'>});</span>

<span class='c1'>// create the editor;</span>
<span class='kd'>var</span> <span class='nx'>editor</span> <span class='o'>=</span> <span class='k'>new</span> <span class='nx'>Editor</span><span class='p'>(</span><span class='s2'>&quot;#editor&quot;</span><span class='p'>);</span>

<span class='c1'>// show the first todo</span>
<span class='nx'>editor</span><span class='p'>.</span><span class='nx'>update</span><span class='p'>({</span><span class='nx'>todo</span><span class='o'>:</span> <span class='nx'>todo1</span><span class='p'>})</span>

<span class='c1'>// switch it to the second todo</span>
<span class='nx'>editor</span><span class='p'>.</span><span class='nx'>update</span><span class='p'>({</span><span class='nx'>todo</span><span class='o'>:</span> <span class='nx'>todo2</span><span class='p'>});</span>
</code></pre>
</div>
<p>Notice that because we are overwriting <code>update</code>, we must call <strong>_super</strong>.</p>

<h2 id='canroute'>Can.route</h2>

<p><a href='http://javascriptmvc.com/docs.html#!#Can.route'>Can.route</a> is the core of JavaScriptMVC&#8217;s routing functionality. It is a <a href='http://javascriptmvc.com/docs.html#!#Can.Observe'>Can.Observe</a> that updates <code>window.location.hash</code> when it&#8217;s properties change and updates its properties when <code>window.location.hash</code> changes. It allows very sophisticated routing behavior &#8230; too sophisticated for this guide. But, it also handles the basics with ease.</p>

<p>Listen to routes in controller&#8217;s with special &#8220;route&#8221; events like:</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>Routing</span> <span class='o'>=</span> <span class='nx'>$</span><span class='p'>.</span><span class='nx'>Controller</span><span class='p'>({</span>
  <span class='s2'>&quot;route&quot;</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(){</span>
    <span class='c1'>// matches empty hash, #, or #!</span>
  <span class='p'>},</span>
  <span class='s2'>&quot;todos/:id route&quot;</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>data</span><span class='p'>){</span>
    <span class='c1'>// matches routes like #!todos/5</span>
  <span class='p'>}</span>
<span class='p'>})</span>

<span class='c1'>// create routing controller</span>
<span class='k'>new</span> <span class='nx'>Routing</span><span class='p'>(</span><span class='nb'>document</span><span class='p'>.</span><span class='nx'>body</span><span class='p'>);</span>
</code></pre>
</div>
<p>The <code>route</code> methods get called back with the route <strong>data</strong>. The empty <code>&quot;route&quot;</code> will be called with no data. But, <code>&quot;todos/:id route&quot;</code> will be called with data like: <code>{id: 6}</code>.</p>

<p>We can update the route by changing $.route&#8217;s data like:</p>
<div class='highlight'><pre><code class='javascript'><span class='nx'>$</span><span class='p'>.</span><span class='nx'>route</span><span class='p'>.</span><span class='nx'>attr</span><span class='p'>(</span><span class='s1'>&#39;id&#39;</span><span class='p'>,</span><span class='s1'>&#39;6&#39;</span><span class='p'>)</span> <span class='c1'>// location.hash = #!todos/6</span>
</code></pre>
</div>
<p>Or we can set the hash ourselves like</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>hash</span> <span class='o'>=</span> <span class='nx'>$</span><span class='p'>.</span><span class='nx'>route</span><span class='p'>.</span><span class='nx'>url</span><span class='p'>({</span><span class='nx'>id</span><span class='o'>:</span> <span class='mi'>7</span><span class='p'>})</span> <span class='c1'>// #!todos/7</span>
<span class='nx'>location</span><span class='p'>.</span><span class='nx'>hash</span> <span class='o'>=</span> <span class='nx'>hash</span><span class='p'>;</span>
</code></pre>
</div>
<p>The following enhances the Routing controller to listen for <code>&quot;.todo selected&quot;</code> events and change the <code>$.route</code>. When the $.route changes, it retrieves the todo from the server and updates the editor widget.</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>Routing</span> <span class='o'>=</span> <span class='nx'>Can</span><span class='p'>.</span><span class='nx'>Control</span><span class='p'>({</span>
  <span class='nx'>init</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(){</span>
    <span class='k'>this</span><span class='p'>.</span><span class='nx'>editor</span> <span class='o'>=</span> <span class='k'>new</span> <span class='nx'>Editor</span><span class='p'>(</span><span class='s2'>&quot;#editor&quot;</span><span class='p'>)</span>
    <span class='k'>new</span> <span class='nx'>Todos</span><span class='p'>(</span><span class='s2'>&quot;#todos&quot;</span><span class='p'>);</span>
  <span class='p'>},</span>
  <span class='c1'>// the index page</span>
  <span class='s2'>&quot;route&quot;</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(){</span>
     <span class='nx'>$</span><span class='p'>(</span><span class='s2'>&quot;#editor&quot;</span><span class='p'>).</span><span class='nx'>hide</span><span class='p'>();</span>
  <span class='p'>},</span>
  <span class='s2'>&quot;todos/:id route&quot;</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>data</span><span class='p'>){</span>
    <span class='nx'>$</span><span class='p'>(</span><span class='s2'>&quot;#editor&quot;</span><span class='p'>).</span><span class='nx'>show</span><span class='p'>();</span>
    <span class='nx'>Todo</span><span class='p'>.</span><span class='nx'>findOne</span><span class='p'>(</span><span class='nx'>data</span><span class='p'>,</span> <span class='nx'>$</span><span class='p'>.</span><span class='nx'>proxy</span><span class='p'>(</span><span class='kd'>function</span><span class='p'>(</span><span class='nx'>todo</span><span class='p'>){</span>
      <span class='k'>this</span><span class='p'>.</span><span class='nx'>editor</span><span class='p'>.</span><span class='nx'>update</span><span class='p'>({</span><span class='nx'>todo</span><span class='o'>:</span> <span class='nx'>todo</span><span class='p'>});</span>
    <span class='p'>},</span> <span class='k'>this</span><span class='p'>))</span>
  <span class='p'>},</span>
  <span class='s2'>&quot;.todo selected&quot;</span> <span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>el</span><span class='p'>,</span> <span class='nx'>ev</span><span class='p'>,</span> <span class='nx'>todo</span><span class='p'>){</span>
    <span class='nx'>$</span><span class='p'>.</span><span class='nx'>route</span><span class='p'>.</span><span class='nx'>attr</span><span class='p'>(</span><span class='s1'>&#39;id&#39;</span><span class='p'>,</span><span class='nx'>todo</span><span class='p'>.</span><span class='nx'>id</span><span class='p'>);</span>
  <span class='p'>}</span>
<span class='p'>});</span>

<span class='c1'>// create routing controller</span>
<span class='k'>new</span> <span class='nx'>Routing</span><span class='p'>(</span><span class='nb'>document</span><span class='p'>.</span><span class='nx'>body</span><span class='p'>);</span>
</code></pre>
</div>
<p>The <strong>Routing</strong> controller is a traditional controller. It coordinates between the <code>$.route</code>, <code>Editor</code> and <code>Todos</code>. <code>Editor</code> and <code>Todos</code> are traditional views, consuming models.</p>

<p>If you can understand this, you understand everything. Congrats! <a href='http://javascriptmvc.com/docs.html#!#tutorials/rapidstart/todos.html'>See it in action</a>.</p>
		</div>
	</div>
</div>
<script src="javascripts/jquery-1.6.4.min.js" type="text/javascript"></script>
<script src="javascripts/jquerymx-3.2.custom.js" type="text/javascript"></script>
<script src="javascripts/application.js" type="text/javascript"></script>
</body>
</html>