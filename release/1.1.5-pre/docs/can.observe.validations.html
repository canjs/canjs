<!DOCTYPE html>  <html> <head>   <title>can.observe.validations.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="can.construct.proxy.html">                 can.construct.proxy.js               </a>                                           <a class="source" href="can.construct.super.html">                 can.construct.super.js               </a>                                           <a class="source" href="can.control.plugin.html">                 can.control.plugin.js               </a>                                           <a class="source" href="can.dojo.html">                 can.dojo.js               </a>                                           <a class="source" href="can.fixture.html">                 can.fixture.js               </a>                                           <a class="source" href="can.jquery-all.html">                 can.jquery-all.js               </a>                                           <a class="source" href="can.jquery.html">                 can.jquery.js               </a>                                           <a class="source" href="can.model.queue.html">                 can.model.queue.js               </a>                                           <a class="source" href="can.mootools.html">                 can.mootools.js               </a>                                           <a class="source" href="can.observe.attributes.html">                 can.observe.attributes.js               </a>                                           <a class="source" href="can.observe.backup.html">                 can.observe.backup.js               </a>                                           <a class="source" href="can.observe.delegate.html">                 can.observe.delegate.js               </a>                                           <a class="source" href="can.observe.setter.html">                 can.observe.setter.js               </a>                                           <a class="source" href="can.observe.validations.html">                 can.observe.validations.js               </a>                                           <a class="source" href="can.view.modifiers.html">                 can.view.modifiers.js               </a>                                           <a class="source" href="can.view.mustache.html">                 can.view.mustache.js               </a>                                           <a class="source" href="can.yui.html">                 can.yui.js               </a>                                           <a class="source" href="can.zepto.html">                 can.zepto.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               can.observe.validations.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/*!</span>
<span class="cm">* CanJS - 1.1.5-pre (2013-03-12)</span>
<span class="cm">* http://canjs.us/</span>
<span class="cm">* Copyright (c) 2013 Bitovi</span>
<span class="cm">* Licensed MIT</span>
<span class="cm">*/</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">can</span><span class="p">,</span> <span class="nb">window</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>can/observe/validations/validations.js</h2>

<p>validations object is by property.  You can have validations that
span properties, but this way we know which ones to run.
 proc should return true if there's an error or the error message</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">validate</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">attrNames</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">proc</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>normalize argumetns</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">proc</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">proc</span> <span class="o">=</span> <span class="nx">options</span><span class="p">;</span>
      <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">}</span>

    <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>
    <span class="nx">attrNames</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">makeArray</span><span class="p">(</span><span class="nx">attrNames</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>run testIf if it exists</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">testIf</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">testIf</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">can</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">attrNames</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">attrName</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Add a test function for each attribute</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">self</span><span class="p">.</span><span class="nx">validations</span><span class="p">[</span><span class="nx">attrName</span><span class="p">])</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">validations</span><span class="p">[</span><span class="nx">attrName</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="p">}</span>

      <span class="nx">self</span><span class="p">.</span><span class="nx">validations</span><span class="p">[</span><span class="nx">attrName</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">newVal</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>if options has a message return that, otherwise, return the error</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">proc</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">newVal</span><span class="p">,</span> <span class="nx">attrName</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">res</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">?</span> <span class="kc">undefined</span> <span class="o">:</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">message</span> <span class="o">||</span> <span class="nx">res</span><span class="p">);</span>
      <span class="p">})</span>
    <span class="p">});</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">old</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">Observe</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__set</span><span class="p">;</span>
  <span class="nx">can</span><span class="p">.</span><span class="nx">Observe</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__set</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">prop</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">current</span><span class="p">,</span> <span class="nx">success</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
      <span class="nx">validations</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">validations</span><span class="p">,</span>
      <span class="nx">errorCallback</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">errors</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">stub</span> <span class="o">=</span> <span class="nx">error</span> <span class="o">&amp;&amp;</span> <span class="nx">error</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">errors</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>if 'setter' is on the page it will trigger
the error itself and we dont want to trigger
the event twice. :)</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">stub</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">can</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">prop</span><span class="p">,</span> <span class="nx">errors</span><span class="p">],</span> <span class="kc">true</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">};</span>

    <span class="nx">old</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">prop</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">current</span><span class="p">,</span> <span class="nx">success</span><span class="p">,</span> <span class="nx">errorCallback</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">validations</span> <span class="o">&amp;&amp;</span> <span class="nx">validations</span><span class="p">[</span><span class="nx">prop</span><span class="p">])</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">errors</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">errors</span><span class="p">(</span><span class="nx">prop</span><span class="p">);</span>
      <span class="nx">errors</span> <span class="o">&amp;&amp;</span> <span class="nx">errorCallback</span><span class="p">(</span><span class="nx">errors</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">can</span><span class="p">.</span><span class="nx">each</span><span class="p">([</span><span class="nx">can</span><span class="p">.</span><span class="nx">Observe</span><span class="p">,</span> <span class="nx">can</span><span class="p">.</span><span class="nx">Model</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">clss</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>in some cases model might not be defined quite yet.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">clss</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">oldSetup</span> <span class="o">=</span> <span class="nx">clss</span><span class="p">.</span><span class="nx">setup</span><span class="p">;</span>

    <span class="nx">can</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">clss</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">setup</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">superClass</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">oldSetup</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">validations</span> <span class="o">||</span> <span class="nx">superClass</span><span class="p">.</span><span class="nx">validations</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">validations</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">validations</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="p">}</span>
      <span class="p">},</span>

      <span class="nx">validate</span><span class="o">:</span> <span class="nx">validate</span><span class="p">,</span>


      <span class="nx">validationMessages</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">format</span><span class="o">:</span> <span class="s2">&quot;is invalid&quot;</span><span class="p">,</span>
        <span class="nx">inclusion</span><span class="o">:</span> <span class="s2">&quot;is not a valid option (perhaps out of range)&quot;</span><span class="p">,</span>
        <span class="nx">lengthShort</span><span class="o">:</span> <span class="s2">&quot;is too short&quot;</span><span class="p">,</span>
        <span class="nx">lengthLong</span><span class="o">:</span> <span class="s2">&quot;is too long&quot;</span><span class="p">,</span>
        <span class="nx">presence</span><span class="o">:</span> <span class="s2">&quot;can&#39;t be empty&quot;</span><span class="p">,</span>
        <span class="nx">range</span><span class="o">:</span> <span class="s2">&quot;is out of range&quot;</span>
      <span class="p">},</span>


      <span class="nx">validateFormatOf</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">attrNames</span><span class="p">,</span> <span class="nx">regexp</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">validate</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">attrNames</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">((</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span> <span class="o">!==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">String</span><span class="p">(</span><span class="nx">value</span><span class="p">).</span><span class="nx">match</span><span class="p">(</span><span class="nx">regexp</span><span class="p">)</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">validationMessages</span><span class="p">.</span><span class="nx">format</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">});</span>
      <span class="p">},</span>


      <span class="nx">validateInclusionOf</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">attrNames</span><span class="p">,</span> <span class="nx">inArray</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">validate</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">attrNames</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
          <span class="p">}</span>

          <span class="k">if</span> <span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">grep</span><span class="p">(</span><span class="nx">inArray</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">elm</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">(</span><span class="nx">elm</span> <span class="o">==</span> <span class="nx">value</span><span class="p">);</span>
          <span class="p">}).</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">validationMessages</span><span class="p">.</span><span class="nx">inclusion</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">});</span>
      <span class="p">},</span>


      <span class="nx">validateLengthOf</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">attrNames</span><span class="p">,</span> <span class="nx">min</span><span class="p">,</span> <span class="nx">max</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">validate</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">attrNames</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(((</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">||</span> <span class="nx">value</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">min</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="nx">min</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">validationMessages</span><span class="p">.</span><span class="nx">lengthShort</span> <span class="o">+</span> <span class="s2">&quot; (min=&quot;</span> <span class="o">+</span> <span class="nx">min</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="nx">max</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">validationMessages</span><span class="p">.</span><span class="nx">lengthLong</span> <span class="o">+</span> <span class="s2">&quot; (max=&quot;</span> <span class="o">+</span> <span class="nx">max</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">});</span>
      <span class="p">},</span>


      <span class="nx">validatePresenceOf</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">attrNames</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">validate</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">attrNames</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">||</span> <span class="nx">value</span> <span class="o">===</span> <span class="s2">&quot;&quot;</span> <span class="o">||</span> <span class="nx">value</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">validationMessages</span><span class="p">.</span><span class="nx">presence</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">});</span>
      <span class="p">},</span>


      <span class="nx">validateRangeOf</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">attrNames</span><span class="p">,</span> <span class="nx">low</span><span class="p">,</span> <span class="nx">hi</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">validate</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">attrNames</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(((</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">||</span> <span class="nx">value</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">low</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">value</span> <span class="o">&lt;</span> <span class="nx">low</span> <span class="o">||</span> <span class="nx">value</span> <span class="o">&gt;</span> <span class="nx">hi</span><span class="p">)))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">validationMessages</span><span class="p">.</span><span class="nx">range</span> <span class="o">+</span> <span class="s2">&quot; [&quot;</span> <span class="o">+</span> <span class="nx">low</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nx">hi</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">});</span>

  <span class="nx">can</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">can</span><span class="p">.</span><span class="nx">Observe</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span>

    <span class="nx">errors</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">attrs</span><span class="p">,</span> <span class="nx">newVal</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>convert attrs to an array</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">attrs</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">attrs</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">attrs</span><span class="p">)</span> <span class="o">?</span> <span class="nx">attrs</span> <span class="o">:</span> <span class="p">[</span><span class="nx">attrs</span><span class="p">];</span>
      <span class="p">}</span>

      <span class="kd">var</span> <span class="nx">errors</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
        <span class="nx">attr</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>helper function that adds error messages to errors object
attr - the name of the attribute
funcs - the validation functions</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">addErrors</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">attr</span><span class="p">,</span> <span class="nx">funcs</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">can</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">funcs</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">func</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">isTest</span> <span class="o">?</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">__convert</span> <span class="o">?</span> <span class="nx">self</span><span class="p">.</span><span class="nx">__convert</span><span class="p">(</span><span class="nx">attr</span><span class="p">,</span> <span class="nx">newVal</span><span class="p">)</span> <span class="o">:</span> <span class="nx">newVal</span><span class="p">)</span> <span class="o">:</span> <span class="nx">self</span><span class="p">[</span><span class="nx">attr</span><span class="p">]);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">errors</span><span class="p">[</span><span class="nx">attr</span><span class="p">])</span> <span class="p">{</span>
                <span class="nx">errors</span><span class="p">[</span><span class="nx">attr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
              <span class="p">}</span>
              <span class="nx">errors</span><span class="p">[</span><span class="nx">attr</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
            <span class="p">}</span>

          <span class="p">});</span>
        <span class="p">},</span>
        <span class="nx">validations</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">validations</span><span class="p">,</span>
        <span class="nx">isTest</span> <span class="o">=</span> <span class="nx">attrs</span> <span class="o">&amp;&amp;</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">2</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>go through each attribute or validation and
add any errors</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">can</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">attrs</span> <span class="o">||</span> <span class="nx">validations</span> <span class="o">||</span> <span class="p">{},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">funcs</span><span class="p">,</span> <span class="nx">attr</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>if we are iterating through an array, use funcs
as the attr name</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">attr</span> <span class="o">==</span> <span class="s1">&#39;number&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">attr</span> <span class="o">=</span> <span class="nx">funcs</span><span class="p">;</span>
          <span class="nx">funcs</span> <span class="o">=</span> <span class="nx">validations</span><span class="p">[</span><span class="nx">attr</span><span class="p">];</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>add errors to the</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">addErrors</span><span class="p">(</span><span class="nx">attr</span><span class="p">,</span> <span class="nx">funcs</span> <span class="o">||</span> <span class="p">[]);</span>
      <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>return errors as long as we have one</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">return</span> <span class="nx">can</span><span class="p">.</span><span class="nx">isEmptyObject</span><span class="p">(</span><span class="nx">errors</span><span class="p">)</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="nx">isTest</span> <span class="o">?</span> <span class="nx">errors</span><span class="p">[</span><span class="nx">attrs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">:</span> <span class="nx">errors</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">});</span>

<span class="p">})(</span><span class="nx">can</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 