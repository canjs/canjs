<!DOCTYPE html>
<!--####################################################################
	THIS IS A GENERATED FILE — ANY CHANGES MADE WILL BE OVERWRITTEN

	INSTEAD CHANGE:
	source: docs/can-guides/upgrade/migrating-to-canjs-5.md
	@page migrate-5
######################################################################## -->
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Migrating to CanJS 5 | upgrade | Guides | CanJS — Build CRUD apps in fewer lines of code.</title>
	<meta name="description" content="This guide walks you through the process to upgrade a 4.x app to CanJS 5.x.">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<meta property="og:image" content="https://www.bitovi.com/hubfs/open-source/os-canjs.png">
	<meta property="og:description" content="This guide walks you through the process to upgrade a 4.x app to CanJS 5.x.">
	<meta property="og:title" content="Migrating to CanJS 5 | upgrade | Guides | CanJS — Build CRUD apps in fewer lines of code.">
	<script type="application/ld+json">
		{
			"@context": "http://www.schema.org",
			"@type": "SoftwareSourceCode",
			"applicationCategory": "DeveloperApplication",
			"brand": "Bitovi",
			"category": "JavaScript Frameworks",
			"codeRepository": "https://github.com/canjs/canjs",
			"description": "This guide walks you through the process to upgrade a 4.x app to CanJS 5.x.",
			"image": "https://www.bitovi.com/hubfs/open-source/os-canjs.png",
			"license": "https://github.com/canjs/canjs/blob/master/license.md",
			"logo": "https://www.bitovi.com/hubfs/open-source/os-canjs.png",
			"name": "Migrating to CanJS 5 | upgrade | Guides | CanJS — Build CRUD apps in fewer lines of code.",
			"programmingLanguage": "JavaScript",
			"softwareVersion" : "6.6.1"
		}
	</script>
	
		<link rel="stylesheet" type="text/css" href="./static/bundles/bit-docs-site/static.css">
		<link rel="shortcut icon" sizes="16x16 24x24 32x32 48x48 64x64" href="/docs/images/canjs_favicon.ico">
		<link rel="apple-touch-icon" sizes="57x57" href="../docs/images/canjs_favicon_57x57.png">
		<link rel="apple-touch-icon-precomposed" sizes="57x57" href="../docs/images/canjs_favicon_57x57.png">
		<link rel="apple-touch-icon" sizes="72x72" href="../docs/images/canjs_favicon_72x72.png">
		<link rel="apple-touch-icon" sizes="114x114" href="../docs/images/canjs_favicon_114x114.png">
		<link rel="apple-touch-icon" sizes="120x120" href="../docs/images/canjs_favicon_128x128.png">
		<link rel="apple-touch-icon" sizes="144x144" href="../docs/images/canjs_favicon_144x144.png">
		<link rel="apple-touch-icon" sizes="152x152" href="../docs/images/canjs_favicon_152x152.png">
		<meta content="yes" name="apple-mobile-web-app-capable">
	  	<meta name="apple-mobile-web-app-status-bar-style" content="white-translucent">
	
	
		<script>
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
				(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
				m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

			ga('create', 'UA-2302003-11', 'auto');
			ga('send', 'pageview');
		</script>
	
</head>
	<body>
		<input type="checkbox" id="nav-trigger" class="nav-trigger"/>
	  	<div data-current-page="migrate-5" id="everything">
  <div class="header">
    
	<label for="nav-trigger">Menu</label>
	<div class="brand">
		<div class="logo">
			<a href="../index.html" alt="CanJS"></a>
			<div class="dropdown project-dropdown">
				<a href="https://donejs.com/">DoneJS</a>
				<a href="https://stealjs.com/">StealJS</a>
				<a href="https://jquerypp.com/">jQuery++</a>
				<a href="https://funcunit.com/">FuncUnit</a>
				<a href="https://documentjs.com/">DocumentJS</a>
			</div>
		</div>
		<div class="version">
			<div class="version-number">
				6.6.1
			</div>
			<div class="dropdown version-dropdown">
				
					<a href="https://v5.canjs.com">5.33.3</a>
				
					<a href="https://v4.canjs.com">4.3.0</a>
				
					<a href="https://v3.canjs.com">3.14.1</a>
				
					<a href="https://v2.canjs.com">2.3.35</a>
				
			</div>
		</div>
	</div>


	
	<ul class="top-right-links">
		
			
				
					<li class="">
						<a class="page"
							href="about.html"
							title="Learn about CanJS’s mission, technical highlights, who uses CanJS, and our future roadmap.">
							About
						</a>
					</li>
				
			
		
			
				
					<li class="current">
						<a class="page"
							href="guides.html"
							title="Welcome to CanJS! These guides are here to help you master CanJS development, get involved with the CanJS community, and contribute back to CanJS.">
							Guides
						</a>
					</li>
				
			
		
			
				
					<li class="">
						<a class="page"
							href="api.html"
							title="Welcome to the CanJS API documentation! This page is a CHEAT-SHEET for the most common APIs within CanJS. Read the technology-overview page for background on the following APIs.">
							API Docs
						</a>
					</li>
				
			
		
			
				
					<li class="">
						<a class="page"
							href="community.html"
							title="Get involved with one of the most inviting communities on the internet!">
							Community
						</a>
					</li>
				
			
		
			
				
					<li class="">
						<a class="page"
							href="guides/contribute.html"
							title="Learn how to contribute to CanJS!">
							Contributing
						</a>
					</li>
				
			
		
	</ul>



<div class="search-section">
	<div class="search-bar">
	<div class="search-wrap" style="display:none;">
		<span class="search-icon"></span>
		<input
			type="text"
			size="6"
			class="search"
			placeholder="Search"
			autocomplete="off"
			autocorrect="off"
			autocapitalize="none"
			spellcheck="false"/>
			<span class="search-icon-cancel"></span>
	</div>
</div>

	<div class="search-bar-container">
	</div>
	<div class="search-results-container">
	<div class="search-results-wrap"></div>
</div>

</div>
<ul class="top-right-bitovi">
	<li class="dropdown">
		<a href="https://www.bitovi.com" class="bitovi by-bitovi">Bitovi</a>
		<ul class="dropdown-menu">
			<li><a href="https://www.bitovi.com/">Bitovi.com</a></li>
			<li><a href="https://www.bitovi.com/blog">Blog</a></li>
			<li><a href="https://www.bitovi.com/design">Design</a></li>
			<li><a href="https://www.bitovi.com/development">Development</a></li>
			<li><a href="https://www.bitovi.com/training">Training</a></li>
			<li><a href="https://www.bitovi.com/open-source">Open Source</a></li>
			<li><a href="https://www.bitovi.com/about">About</a></li>
			<li><a href="https://www.bitovi.com/contact">Contact Us</a></li>
		</ul>
	</li>
</ul>

  </div>
  <div id="left" class="column">

      <div class="nav-menu">
        
            
	<ul>
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="about.html"
							title="Learn about CanJS’s mission, technical highlights, who uses CanJS, and our future roadmap.">
							About
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						parent
           						expanded">
						<a class="page"
							href="guides.html"
							title="Welcome to CanJS! These guides are here to help you master CanJS development, get involved with the CanJS community, and contribute back to CanJS.">
							Guides
						</a>
						
	<ul>
		
			
				
					<li>
						<span>getting started</span>
						
	<ul>
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/crud-beginner.html"
							title="Learn how to build a basic CRUD app with CanJS in 30 minutes.">
							CRUD Guide
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/setup.html"
							title="Learn how to install CanJS in your environment.">
							Setting Up CanJS
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/technology-overview.html"
							title="Learn the basics of CanJS’s technology.">
							Technology Overview
						</a>
						

					</li>
				
			
		
	</ul>


					</li>
				
			
		
			
				
					<li>
						<span>topics</span>
						
	<ul>
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/html.html"
							title="Learn how to update HTML and listen to user interactions.">
							HTML
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/routing.html"
							title="Learn how to make your application respond to changes in the URL and work with the browser’s back and forward buttons.">
							Routing
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/data.html"
							title="Learn how to use can-connect to integrate service layer APIs into your CanJS application.">
							Service Layer
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/debugging.html"
							title="Learn how to debug CanJS applications.">
							Debugging
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/forms.html"
							title="Learn how to create amazing &lt;form&gt;s with CanJS.">
							Forms
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/testing.html"
							title="Learn how to test CanJS applications.">
							Testing
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/logic.html"
							title="Learn how to write observables in an organized, maintainable, and testable way.">
							Logic
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/server-side-rendering.html"
							title="Learn how to set up SSR for CanJS.">
							Server-Side Rendering
						</a>
						

					</li>
				
			
		
	</ul>


					</li>
				
			
		
			
				
					<li>
						<span>app guides</span>
						
	<ul>
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/chat.html"
							title="This guide will walk you through building a real-time chat application with CanJS’s Core libraries.  It takes about 30 minutes to complete.">
							Chat Guide
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/todomvc.html"
							title="This guide will walk you through building a slightly modified version of TodoMVC with CanJS’s Core libraries and can-fixture. It takes about 1 hour to complete.">
							TodoMVC Guide
						</a>
						

					</li>
				
			
		
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/recipes/todomvc-with-steal.html"
							title="This tutorial walks through building TodoMVC with StealJS. It includes KeyNote presentations covering CanJS core libraries.">
							TodoMVC with StealJS
						</a>
						

					</li>
				
			
		
	</ul>


					</li>
				
			
		
			
				
					<li>
						<span>beginner recipes</span>
						
	<ul>
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/recipes/canvas-clock.html"
							title="This beginner guide walks you through building a clock with the Canvas API.">
							Canvas Clock
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/recipes/credit-card-simple.html"
							title="This beginner guide walks through building a very simple credit card payment form.  It uses Stripe.js v2 API to create a token which can be used to create a charge.  It also performs simple validation on the payment form values.">
							Credit Card
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/recipes/file-navigator-simple.html"
							title="This beginner guide walks you through building a simple file navigation widget.  It takes about 25 minutes to complete.  It was written with CanJS 6.0.0. Check out the file-navigator-advanced for an example that makes AJAX requests for its data and uses can-stache-element.">
							File Navigator
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/recipes/signup-simple.html"
							title="This beginner guide walks through building simple signup, login forms and a logout button.">
							Signup and Login
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/recipes/video-player.html"
							title="This beginner guide walks you through building custom video controls around a video element.">
							Video Player
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/recipes/weather-report-simple.html"
							title="This beginner guide walks you through building a simple weather report widget.  It takes about 25 minutes to complete.  It was written with CanJS 6.2.">
							Weather Report
						</a>
						

					</li>
				
			
		
	</ul>


					</li>
				
			
		
			
				
					<li>
						<span>intermediate recipes</span>
						
	<ul>
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/recipes/cta-bus-map.html"
							title="This intermediate guide walks you through showing Chicago Transit Authority (CTA) bus locations on a Google Map. You&#x27;ll learn how to create a StacheElement that integrates with 3rd party widgets.">
							CTA Bus Map
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/recipes/modals.html"
							title="This intermediate guide shows how to create a multiple modal form.">
							Multiple Modals
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/recipes/text-editor.html"
							title="This intermediate guide walks you through building a basic rich text editor.">
							Text Editor
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/recipes/tinder-carousel.html"
							title="This intermediate guide walks you through building a Tinder-like carousel. Learn how to build apps that use dragging user interactions.">
							Tinder Carousel
						</a>
						

					</li>
				
			
		
	</ul>


					</li>
				
			
		
			
				
					<li>
						<span>advanced recipes</span>
						
	<ul>
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/recipes/credit-card-advanced.html"
							title="This advanced guide walks through building a simple credit card payment form with validations. It doesn’t use can-define. Instead it uses Kefir.js streams to make a ViewModel. can-kefir is used to make the Kefir streams observable to can-stache.">
							Credit Card
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/recipes/file-navigator-advanced.html"
							title="This advanced guide walks you through building a file navigation widget that requests data with fetch. It takes about 45 minutes to complete.">
							File Navigator
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/recipes/playlist-editor.html"
							title="Learn how to use YouTube’s API to search for videos and make a playlist.  This makes authenticated requests with OAuth2. It uses jQuery++ for drag/drop events. It shows using custom attributes and custom events.  This advanced guide takes an hour to complete.  This recipe uses YouTube API Services and follows YouTube Terms of Service and Google Privacy Policy">
							Playlist Editor
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/recipes/search-list-details.html"
							title="This advanced guide walks through building a Search, List, Details flow with lazy-loaded routes.">
							Search, List, Details
						</a>
						

					</li>
				
			
		
			
		
	</ul>


					</li>
				
			
		
			
				
					<li>
						<span>upgrade</span>
						
	<ul>
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="migrate-3.html"
							title="This guide walks you through the step-by-step process to upgrade a 2.x app to CanJS 3.">
							Migrating to CanJS 3
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="migrate-4.html"
							title="This guide walks you through the step-by-step process to upgrade a 3.x app to CanJS 4.">
							Migrating to CanJS 4
						</a>
						

					</li>
				
			
		
			
				
					<li class="current
           						
           						expanded">
						<a class="page"
							href="migrate-5.html"
							title="This guide walks you through the process to upgrade a 4.x app to CanJS 5.x.">
							Migrating to CanJS 5
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="migrate-6.html"
							title="This guide walks you through the process to upgrade a 5.x app to CanJS 6.x.">
							Migrating to CanJS 6
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/upgrade/using-codemods.html"
							title="Learn how to migrate your app to CanJS 6 using can-migrate.">
							Using Codemods
						</a>
						

					</li>
				
			
		
	</ul>


					</li>
				
			
		
			
				
					<li>
						<span>other</span>
						
	<ul>
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/api.html"
							title="This page walks through how to use and understand CanJS’s API documentation.">
							Reading the API Docs
						</a>
						

					</li>
				
			
		
	</ul>


					</li>
				
			
		
	</ul>


					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="api.html"
							title="Welcome to the CanJS API documentation! This page is a CHEAT-SHEET for the most common APIs within CanJS. Read the technology-overview page for background on the following APIs.">
							API Docs
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="community.html"
							title="Get involved with one of the most inviting communities on the internet!">
							Community
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="guides/contribute.html"
							title="Learn how to contribute to CanJS!">
							Contributing
						</a>
						

					</li>
				
			
		
	</ul>


        
      </div>
      <div class="social-side-container">
        <ul class="social-side">
  <li>
    <a class="header-mobile github" href="https://github.com/canjs/canjs" target="_blank"><img class="social-icon-small" src="../docs/images/github.png">GitHub</a>
  </li>
  <li>
    <a class="header-mobile twitter" href="https://twitter.com/canjs" target="_blank"><img class="social-icon-small" src="../docs/images/twitter.png">Twitter</a>
  </li>
</ul>
<ul class="social-side">
  <li>
    <a class="header-mobile" href="https://www.bitovi.com/community/slack" target="_blank">Chat</a>
  </li>
  <li>
    <a class="header-mobile" href="https://forums.bitovi.com/c/canjs" target="_blank">Forum</a>
  </li>
</ul>
<ul class="social-side">
  <li>
    <a class="header-mobile" href="https://www.bitovi.com/blog/topic/canjs" target="_blank">News</a>
  </li>
  <li></li>
</ul>

      </div>
      <div class="by-bitovi-container">
        <a href="https://www.bitovi.com" target="_blank" class="bitovi by-bitovi">Bitovi</a>
      </div>

  </div>
  <div id="right" class="column">

      <article>
  <section class="title">
	<div class="page-type">
		<h1>Migrating to CanJS 5</h1>
			<ul class="title-social">
				
				
				<li>
					<a class="button-link" href="//github.com/canjs/canjs/edit/master/docs/can-guides/upgrade/migrating-to-canjs-5.md">Edit on GitHub</a>
				</li>
				
			</ul>
	</div>
	<div class="clear-both"></div>
	
  
	<section class="description">
    <p>This guide walks you through the process to upgrade a 4.x app to CanJS 5.x.</p>

</section>

  
	
</section>
<section class="on-this-page-table">
	<!--<h2 class="on-this-page-title" data-skip>Page Content</h2>-->
</section>










  
    <section class="body">
    <h2>Why Upgrade</h2>
<p>CanJS 5.0:</p>
<ul>
<li>Is easy to upgrade to! Only the model layer has breaking changes and there's a <a href="can-set-legacy.html" title="can-set-legacy supports a legacy can-set API that creates a can-query-logic instance.">compatibility api</a> that
eliminates most breaking changes.</li>
<li>Supports named exports from the &quot;can&quot; package!  The following is a &quot;hello world&quot;:
<pre><code class="language-js">import {Component} from &quot;can&quot;;
Component.extend({
  tag: &quot;hello-world&quot;,
  view: `{{message}} World!`,
  ViewModel: {  message: {default: &quot;Hello&quot;} }
});
</code></pre></li>
<li>Simplifies the model layer!
<ul>
<li><p>Use nicely documented, pre-built models for common scenarios:</p>
<ul>
<li><a href="can-rest-model.html" title="Connect a type to a restful service layer.">can-rest-model</a> - A simple restful connection without the need to configure a <a href="can-query-logic.html" title="Perform data queries and compare queries against each other. Provides logic useful for
data caching and real-time behavior.">can-query-logic</a>.</li>
<li><a href="can-realtime-rest-model.html" title="Connect a type to a restful data source and automatically manage lists.">can-realtime-rest-model</a> - A simple restful connection with automatic list management.</li>
<li><a href="can-super-model.html" title="Connect a type to a restful data source, automatically manage lists, combine requests, and use a fall-through localstorage cache.">can-super-model</a> - A restful connection with most of <a href="can-connect.html" title="can-connect provides persisted data middleware. Assemble powerful model layers from fully modularized behaviors (i.e. plugins).">can-connect</a>’s features already configured.</li>
</ul></li>
<li><p>More easily configure <a href="can-query-logic.html" title="Perform data queries and compare queries against each other. Provides logic useful for
data caching and real-time behavior.">can-query-logic</a>.  If your service layer matches <a href="can-query-logic.html" title="Perform data queries and compare queries against each other. Provides logic useful for
data caching and real-time behavior.">can-query-logic</a>’s expectations,
all configuration comes from your <a href="can-define/map/map.html" title="Create observable objects.">DefineMap</a>.  The following defines a <code>Todo</code>
type and connects it to a restful service. No need to create a <code>new set.Algebra()</code>!</p>
<pre><code class="language-js">import {DefineMap, DefineList, realtimeRestModel} from &quot;can&quot;;

const Todo = DefineMap.extend({
    // Configures `id` as the unique property.
    id: {identity: true, type: &quot;number&quot;},

    // Configures `name` as allowing null, undefined, or string values
    name: &quot;string&quot;,

    // Configures `complete` as allowing true, false, null, or undefined
    complete: &quot;boolean&quot;,

    // Configures `dueDate` as allowing null, undefined, or date values
    // Also will support queries like:
    // {filter: {dueDate: {$gt: &quot;Thu Jun 07 2018 10:00:00 GMT-0500 (CDT)&quot;}}}
    dueDate: &quot;date&quot;
});

Todo.List = DefineList.extend({&quot;#&quot;: Todo})

realtimeRestModel({
    Map: Todo,
    url: &quot;/todos/{id}&quot;
})
</code></pre></li>
<li><p>Automatic list management (also known as <a href="can-connect/real-time/real-time.html" title="Update lists to include or exclude instances based
on set logic.">real-time</a>) and <a href="can-fixture.html" title="Intercept AJAX requests and simulate the response.">can-fixture</a> support
<a href="can-query-logic/comparison-operators.html" title="The comparison operators available to the default query.">MongoDB-style comparison operators</a> like <code>$in</code>, <code>$ne</code>, <code>$lte</code>, etc.
The following shows simulating
a service that supports filtering with <em>MongoDB-style comparison operators</em> and makes a request
for todos using those <em>comparison operators</em>:</p>
<pre><code class="language-js">import {fixture} from &quot;can-fixture&quot;;

const todoStore = fixture.store([
    { id: 1, name: &quot;Do the dishes&quot;, complete: true, dueDate: &quot;2018-06-01&quot; },
    { id: 2, name: &quot;Walk the dog&quot;, complete: false, dueDate: &quot;2018-06-28&quot; } ], Todo);

fixture(&quot;/todos/{id}&quot;, todoStore);

// Request todos after June 7th
Todo.getList({
    filter: {
        dueDate: { $gt: &quot;Thu Jun 07 2018 10:00:00 GMT-0500 (CDT)&quot; }
    }
}).then(function(todos){
    // Only receive todos after June 7th
    todos //-&gt; Todo.List[ Todo{id: 2, ...} ]
})
</code></pre></li>
<li><p>If your service layer does not match <a href="can-query-logic.html" title="Perform data queries and compare queries against each other. Provides logic useful for
data caching and real-time behavior.">can-query-logic</a>’s expectations,
it’s far easier to configure than <a href="can-set-legacy.html" title="can-set-legacy supports a legacy can-set API that creates a can-query-logic instance.">can-set</a>. For example, if
your service layer uses <code>orderBy</code> instead of <code>sort</code>, you just need to provide functions that
translate back and forth between your servers parameters and <code>can-query-logic</code>’s <a href="can-query-logic/query.html" title="The default structure of objects used to represent queries.">query format</a>.</p>
<pre><code class="language-js">import {DefineMap, DefineList, realtimeRestModel, QueryLogic} from &quot;can&quot;;

const Todo = DefineMap.extend({
    // Configures `id` as the unique property.
    id: {identity: true, type: &quot;number&quot;},

    // Configures `name` as allowing null, undefined, or string values
    name: &quot;string&quot;,

    // Configures `complete` as allowing true, false, null, or undefined
    complete: &quot;boolean&quot;,

    // Configures `dueDate` as allowing null, undefined, or date values
    // Also will support queries like:
    // {filter: {dueDate: {$gt: &quot;Thu Jun 07 2018 10:00:00 GMT-0500 (CDT)&quot;}}}
    dueDate: &quot;date&quot;
});

Todo.List = DefineList.extend({&quot;#&quot;: Todo});

const todoQueryLogic = new QueryLogic(Todo,{
    toQuery(params){
        let query = {...params};
        if(query.orderBy != null) {
            query.sort = query.orderBy;
            delete query.orderBy;
        }
        return query;
    },
    toParams(query){
        let params = {...query};
        if(params.orderBy != null) {
            params.sort = params.orderBy;
            delete params.orderBy;
        }
        return params;
    }
});

realtimeRestModel({
    Map: Todo,
    url: &quot;/todos/{id}&quot;,
    queryLogic: todoQueryLogic
})
</code></pre>
<p>There's <a href="can-query-logic.html#Configuration" title="Perform data queries and compare queries against each other. Provides logic useful for
data caching and real-time behavior.">detailed documentation</a> on how
to configure a <code>new QueryLogic()</code> for any circumstances.</p>
<div line-highlight='21-38,43,only'></div></li>
</ul></li>
<li>Includes guides on <a href="guides/html.html" title="Learn how to update HTML and listen to user interactions.">HTML</a>, <a href="guides/routing.html" title="Learn how to make your application respond to changes in the URL and work with the browser’s back and forward buttons.">Routing</a>, <a href="guides/data.html" title="Learn how to use can-connect to integrate service layer APIs into your CanJS application.">Service Layer</a>, <a href="guides/testing.html" title="Learn how to test CanJS applications.">Testing</a> and <a href="guides/logic.html" title="Learn how to write observables in an organized, maintainable, and testable way.">Logic</a>.</li>
<li>Includes hundreds of other bug fixes and new features, including:
<ul>
<li>New stache helpers for logic: <a href="can-stache.helpers.and.html" title="Perform a logical AND (&amp;&amp;).">and()</a>, <a href="can-stache.helpers.or.html" title="Perform a logical OR (||).">or()</a>, and <a href="can-stache.helpers.not.html" title="">not()</a>.</li>
<li><a href="can-stache.helpers.let.html" title="Create a block-level variable.">#let stache helper</a> for creating block-level variables.</li>
<li><a href="can-stache.helpers.for-of.html" title="Loop through a list of values, keys in an object, or integers.">#for(of) stache helper</a> for looping through lists without creating new contexts.</li>
<li><a href="can-stache.portal.html" title="">#portal stache helper</a> for inserting a section of a template into another element.</li>
<li><a href="can-stache/keys/scope/key.html" title="Looks up the key on the scope or helper scope in a template, walking until a value is found.">scope/key</a> syntax for scope walking within a stache template.</li>
<li><a href="https://github.com/canjs/can-component/releases/tag/v4.3.0">Component elements now have a <code>.viewModel</code> property.</a></li>
<li><a href="https://github.com/canjs/can-component/releases/tag/v4.4.0">Slots are able to pass individual values.</a></li>
<li>Support for <a href="can-stache-bindings.event.html#on_VIEW_MODEL_OR_DOM_EVENT__KEY_VALUE_" title="Respond to events on elements or component ViewModels.">setting properties within event handlers in stache</a> (e.g. <code>on:click=&quot;this.prop = value&quot;</code>).</li>
<li>Security: XSS vulnerability fix in <a href="https://github.com/canjs/canjs/releases/tag/v5.13.0">v5.13.0</a>.</li>
<li>New packages: <a href="can-map-compat.html" title="can-map-compat">can-map-compat</a> and <a href="can-route-mock.html" title="Simulate routing without having to change the URL.">can-route-mock</a>.</li>
<li>Internet Explorer 11 support</li>
</ul></li>
</ul>
<h2>Breaking Changes</h2>
<p>The following is a list of changes you must make to use CanJS 5.0.</p>
<h3>Replace <code>can-set</code> with <code>can-set-legacy</code></h3>
<p>The biggest change to CanJS 5.0 from 4.0 was the replacement of <code>can-set</code> with
<a href="can-query-logic.html" title="Perform data queries and compare queries against each other. Provides logic useful for
data caching and real-time behavior.">can-query-logic</a>.  If you are using <code>can-set</code>, it’s likely you can upgrade by using <a href="can-set-legacy.html" title="can-set-legacy supports a legacy can-set API that creates a can-query-logic instance.">can-set-legacy</a>
instead of <code>can-set</code>. So if you had code like:</p>
<pre><code class="language-js">import set from &quot;can-set&quot;;
import DefineMap from &quot;can-define/map/map&quot;;
import superMap from &quot;can-connect/can/super-map/super-map&quot;;

const Todo = DefineMap.extend({ /* ... */ });

todoAlgebra = new set.Algebra(
    set.props.id(&quot;_id&quot;),
    set.props.enum(&quot;status&quot;,[&quot;new&quot;,&quot;pending&quot;,&quot;resolved&quot;]),
    set.props.boolean(&quot;complete&quot;)
);

superMap({
    Map: Todo,
    algebra: todoAlgebra,
    // ...
})
</code></pre>
<p>You can simply use <a href="can-set-legacy.html" title="can-set-legacy supports a legacy can-set API that creates a can-query-logic instance.">can-set-legacy</a> instead like:</p>
<pre><code class="language-js">import set from &quot;can-set-legacy&quot;;
import DefineMap from &quot;can-define/map/map&quot;;
import DefineList from &quot;can-define/list/list&quot;;
import superMap from &quot;can-connect/can/super-map/super-map&quot;;

const Todo = DefineMap.extend({ /* ... */ });
Todo.List = DefineList.extend({&quot;#&quot;: Todo, /* ... */});

todoAlgebra = new set.Algebra(
    set.props.id(&quot;_id&quot;),
    set.props.enum(&quot;status&quot;,[&quot;new&quot;,&quot;pending&quot;,&quot;resolved&quot;]),
    set.props.boolean(&quot;complete&quot;)
);

superMap({
    Map: Todo,
    algebra: todoAlgebra,
    // ...
})
</code></pre>
<p><a href="can-set-legacy.html" title="can-set-legacy supports a legacy can-set API that creates a can-query-logic instance.">can-set-legacy</a> is highly compatible with <code>can-set</code>.  It returns an
instance of <a href="can-query-logic.html" title="Perform data queries and compare queries against each other. Provides logic useful for
data caching and real-time behavior.">can-query-logic</a> so it is not perfectly compatible, but it should
be enough for the vast majority of applications to upgrade without problems.</p>
<p>If you'd like to upgrade to avoid using <code>can-set-legacy</code>, the above code could be replaced with the <a href="can-query-logic.html" title="Perform data queries and compare queries against each other. Provides logic useful for
data caching and real-time behavior.">can-query-logic</a> equivalent:</p>
<pre><code class="language-js">import DefineMap from &quot;can-define/map/map&quot;;
import superModel from &quot;can-super-model&quot;;
import QueryLogic from &quot;can-query-logic&quot;;

const Todo = DefineMap.extend({
    _id: {identity: true, type: &quot;number&quot;},
    name: &quot;string&quot;,
    complete: QueryLogic.makeEnum([true, false]),
    status: QueryLogic.makeEnum([&quot;new&quot;,&quot;pending&quot;,&quot;resolved&quot;])
});
Todo.List = DefineList.extend({&quot;#&quot;: Todo, /* ... */});

let todoQueryLogic = new QueryLogic(Todo,{
    toQuery(params){
        return {filter: params};
    },
    toParams(query){
        return query.filter;
    }
})

superModel({
    Map: Todo,
    queryLogic: todoQueryLogic,
    // ...
})
</code></pre>
<blockquote>
<p><strong>Note:</strong> If the service layer can be re-written to match <a href="can-query-logic.html" title="Perform data queries and compare queries against each other. Provides logic useful for
data caching and real-time behavior.">can-query-logic</a>’s
format, configuring a <code>queryLogic</code> instance isn't necessary.  Read
more about this format in <a href="can-rest-model.html" title="Connect a type to a restful service layer.">can-rest-model</a>’s documentation.</p>
</blockquote>
<h3>Create a list type on all connections</h3>
<p>Previously, <a href="can-connect/can/map/map.html" title="Integrate a can-connect connection with a DefineMap type.">can-connect/can/map/map</a> would create a default list type for connections
if one was not supplied. For example, the following only provides a <code>Map</code> setting, but a <code>List</code> is created:</p>
<pre><code class="language-js">import connect from &quot;can-connect&quot;;
import dataUrl from &quot;can-connect/data/url/url&quot;;
import constructor from &quot;can-connect/constructor/constructor&quot;;
import canMap from &quot;can-connect/can/map/map&quot;;
import DefineMap from &quot;can-define/map/map&quot;;

const Todo = DefineMap.extend({
    id: &quot;number&quot;,
    // ...
});

const todoConnection = connect( [ dataUrl, constructor, canMap ], {
    Map: Todo,
    url: &quot;/services/todos&quot;
});

todoConnection.List //-&gt; DefineList
</code></pre>
<p>In CanJS 5.0, you must provide a <code>List</code> type yourself:</p>
<pre><code class="language-js">import connect from &quot;can-connect&quot;;
import dataUrl from &quot;can-connect/data/url/url&quot;;
import constructor from &quot;can-connect/constructor/constructor&quot;;
import canMap from &quot;can-connect/can/map/map&quot;;
import DefineMap from &quot;can-define/map/map&quot;;
import DefineList from &quot;can-define/list/list&quot;;

const Todo = DefineMap.extend({
    id: &quot;number&quot;,
    // ...
});
const TodoList = DefineList.extend({
    &quot;#&quot;: Todo
});

const todoConnection = connect( [ dataUrl, constructor, canMap ], {
    Map: Todo,
    List: TodoList,
    url: &quot;/services/todos&quot;
});
</code></pre>
<div line-highlight='12-14,18'></div>
<p>The <code>List</code> type can also be on the <code>Map</code>:</p>
<pre><code class="language-js">import connect from &quot;can-connect&quot;;
import dataUrl from &quot;can-connect/data/url/url&quot;;
import constructor from &quot;can-connect/constructor/constructor&quot;;
import canMap from &quot;can-connect/can/map/map&quot;;
import DefineMap from &quot;can-define/map/map&quot;;
import DefineList from &quot;can-define/list/list&quot;;

const Todo = DefineMap.extend({
    id: &quot;number&quot;,
    // ...
});
Todo.List = DefineList.extend({
    &quot;#&quot;: Todo
});

const todoConnection = connect( [ dataUrl, constructor, canMap ], {
    Map: Todo,
    url: &quot;/services/todos&quot;
});
</code></pre>
<div line-highlight='12-14,17-18'></div>
<p>All model types, for example <a href="can-rest-model.html" title="Connect a type to a restful service layer.">can-rest-model</a> and <a href="can-realtime-rest-model.html" title="Connect a type to a restful data source and automatically manage lists.">can-realtime-rest-model</a>, must also be passed a <code>List</code> type.</p>
<h3>Create, update, and delete requests must return all properties or set <code>updateInstanceWithAssignDeep</code> to true</h3>
<p>In 4.0, <a href="can-connect/can/map/map.html" title="Integrate a can-connect connection with a DefineMap type.">can-connect/can/map/map</a> performed <strong>assignment</strong> with the data returned
from the server. For example, if a todo was created as follows:</p>
<pre><code class="language-js">const todo = new Todo({
    name: &quot;laundry&quot;,
    complete: false
}).save();
</code></pre>
<p>If the server returned the following JSON (<em>note</em> the missing <code>complete</code> property):</p>
<pre><code class="language-js">{
    id: 5, name: &quot;Laundry&quot;
}
</code></pre>
<p>The todo would have the following properties:</p>
<pre><code class="language-js">todo //-&gt; Todo{id: 5, name: &quot;Laundry&quot;, complete: false}
</code></pre>
<p>In 4.0, the response value was &quot;assigned&quot; to the instance. Missing properties were <strong>not</strong> deleted.</p>
<p>In <strong>5.0</strong>, the response is <strong>merged</strong> into the instance.  Missing properties <strong>will</strong> be deleted. This means that
in 5.0, the above response would delete the <code>complete</code> property, resulting in a todo like:</p>
<pre><code class="language-js">todo //-&gt; Todo{id: 5, name: &quot;Laundry&quot;}
</code></pre>
<blockquote>
<p><strong>Note:</strong> The 5.0 <strong>merge</strong> behavior is quite powerful when dealing with nested data.  You can read more about the
behavior on its documentation page: <a href="can-diff/merge-deep/merge-deep.html" title="Update the contents of one object with another object.">can-diff/merge-deep/merge-deep</a>.</p>
</blockquote>
<p>The solution is to either change your services to return all properties or set your connection's <a href="can-connect/can/map/map.updateInstanceWithAssignDeep.html" title="Use the response from save() and destroy() to assign properties, never delete them.">updateInstanceWithAssignDeep</a> property to <code>true</code>:</p>
<pre><code class="language-js">import connect from &quot;can-connect&quot;;
import dataUrl from &quot;can-connect/data/url/url&quot;;
import constructor from &quot;can-connect/constructor/constructor&quot;;
import canMap from &quot;can-connect/can/map/map&quot;;
import DefineMap from &quot;can-define/map/map&quot;;
import DefineList from &quot;can-define/list/list&quot;;

const Todo = DefineMap.extend({
    id: &quot;number&quot;,
    // ...
});
Todo.List = DefineList.extend({
    &quot;#&quot;: Todo
});

const todoConnection = connect( [ dataUrl, constructor, canMap ], {
    Map: Todo,
    url: &quot;/services/todos&quot;,
    updateInstanceWithAssignDeep: true
});
</code></pre>
<div line-highlight='19'></div>
<h3>Replace <code>idProp</code> configuration with an <code>identity</code> configuration</h3>
<p>In 4.0, it was possible to configure your the property that defined your identity with an <code>idProp</code>. For example,
the following uses it to specify the <code>idProp</code> as <code>_id</code>:</p>
<pre><code class="language-js">import connect from &quot;can-connect&quot;;
import dataUrl from &quot;can-connect/data/url/url&quot;;
import constructor from &quot;can-connect/constructor/constructor&quot;;
import canMap from &quot;can-connect/can/map/map&quot;;
import DefineMap from &quot;can-define/map/map&quot;;
import DefineList from &quot;can-define/list/list&quot;;

const Todo = DefineMap.extend({
    _id: &quot;number&quot;,
    // ...
});
Todo.List = DefineList.extend({
    &quot;#&quot;: Todo
});

const todoConnection = connect( [ dataUrl, constructor, canMap ], {
    Map: Todo,
    url: &quot;/services/todos&quot;,
    idProp: &quot;_id&quot;
});
</code></pre>
<div line-highlight='19'></div>
<p><code>idProp</code> is no longer supported.</p>
<p>In 5.0, there are multiple ways to configure the identity property. The <code>identity</code> property comes
from the <a href="can-query-logic.html" title="Perform data queries and compare queries against each other. Provides logic useful for
data caching and real-time behavior.">can-query-logic</a> created by or passed to the <code>todoConnection</code>. For example, you can specify the
<code>identity</code> properties on the <strong>schema</strong> passed to <code>new QueryLogic(schema)</code>:</p>
<pre><code class="language-js">const Todo = DefineMap.extend({
    _id: &quot;number&quot;,
    // ...
});
Todo.List = DefineList.extend({
    &quot;#&quot;: Todo
});

const todoConnection = connect( [ dataUrl, constructor, canMap ], {
    Map: Todo,
    url: &quot;/services/todos&quot;,
    queryLogic: new QueryLogic({
        identity: [&quot;_id&quot;]
    })
});
</code></pre>
<div line-highlight='12-14'></div>
<p><strong>Schemas</strong> are available on <a href="can-define/map/map.html" title="Create observable objects.">DefineMap</a>s.  So you could also use the <a href="can-define.types.identity.html" title="Specifies that the property uniquely identifies instances of the type.">identity</a> property
behavior to specify that <code>_id</code> is the identity property:</p>
<pre><code class="language-js">const Todo = DefineMap.extend({
    _id: {type: &quot;number&quot;, identity: true}
    // ...
});
Todo.List = DefineList.extend({
    &quot;#&quot;: Todo
});

const todoConnection = connect( [ dataUrl, constructor, canMap ], {
    Map: Todo,
    url: &quot;/services/todos&quot;,
    queryLogic: new QueryLogic(Todo)
});
</code></pre>
<div line-highlight='2,12'></div>
<p>Finally, if <code>queryLogic</code> is only being configured by the same type that is being passed as <code>Map</code>,
no <code>queryLogic</code> is needed as this will happen by default.  The following is equivalent to the previous example:</p>
<pre><code class="language-js">const Todo = DefineMap.extend({
    _id: {type: &quot;number&quot;, identity: true}
    // ...
});
Todo.List = DefineList.extend({
    &quot;#&quot;: Todo
});

const todoConnection = connect( [ dataUrl, constructor, canMap ], {
    Map: Todo,
    url: &quot;/services/todos&quot;
});
</code></pre>
<h3>Replace __listSet with with the can.listQuery symbol</h3>
<p>In CanJS 4.0, the default <a href="can-connect/base/base.listQueryProp.html" title="Specifies the property that uniquely identifies a list.">listQueryProp</a> was <code>__listSet</code>.  It is now
a <code>can.listQuery</code> symbol.  If you were setting <code>__listSet</code> on an List like the following:</p>
<pre><code class="language-js">const ClassRoom = DefineMap.extend({
    // ...
    students: {
        type: Student.List
        set(students) {
            students.__listSet = {filter: {classRoomId: this._id}}
            return students;
        }
    }
})
</code></pre>
<p>You should do it as follows:</p>
<pre><code class="language-js">const ClassRoom = DefineMap.extend({
    // ...
    students: {
        type: Student.List
        set(students) {
            students[Symbol.for(&quot;can.listQuery&quot;)] = {filter: {classRoomId: this._id}}
            return students;
        }
    }
})
</code></pre>
<blockquote>
<p><strong>Note:</strong> use <a href="can-symbol.html" title="Symbols used to detail how CanJS may operate on different objects
CanJS has a consistent internal interface for objects to interact with each other, and this is also important for interop
with external libraries.  CanJS uses symbols to identify object types, property access methods, and for event
handling.
can-symbol also has a polyfill function that will fake symbols on unsupported platforms.">can-symbol</a> if you want IE11 support.</p>
</blockquote>
<h3>Set urlData when using can-route-pushstate</h3>
<p>In <code>can-route-pushstate</code> 4.X it would automatically register itself as the default binding with <code>can-route</code>. In order to reduce the amount of side-effectual packages CanJS has, we changed this in can-route-pushstate 5.0 so that you must explicitly register it.</p>
<p>To do this you need to:</p>
<ul>
<li>import the <code>RoutePushstate</code> constructor function.</li>
<li>Create a new instance.</li>
<li>Set it to the <code>route.urlData</code> property.</li>
</ul>
<pre><code class="language-js">import RoutePushstate from 'can-route-pushstate';
import route from 'can-route';

route.urlData = new RoutePushstate();
route.register('{page}', { page: 'home' });
route.start();
</code></pre>
<div line-highlight='4'></div>
<h3>Don’t parse error responses with can-ajax</h3>
<p>This is a common pattern with <a href="can-ajax.html" title="Make an asynchronous HTTP (AJAX) request.">can-ajax</a> 1:</p>
<pre><code class="language-js">import ajax from 'can-ajax';

ajax().then(function() {
    // Handle a successful response…
}, function(xhr) {
    const error = JSON.parse(xhr.responseText);
    // Do something with error…
});
</code></pre>
<div line-highlight='5-6'></div>
<p>With <a href="can-ajax.html" title="Make an asynchronous HTTP (AJAX) request.">can-ajax</a> 2, you no longer need to parse the <code>responseText</code>:</p>
<pre><code class="language-js">import ajax from 'can-ajax';

ajax().then(function() {
    // Handle a successful response…
}, function(error) {
    // Do something with error…
});
</code></pre>
<div line-highlight='5'></div>
<h2>Recommended Changes</h2>
<p>The following are suggested changes to make sure your application is compatible beyond 5.0.</p>
<h3>Use new models instead of old models</h3>
<p><code>can-connect</code> 2.X had some pre-configured modules that created a connection of
multiple behaviors:</p>
<ul>
<li><a href="can-connect/can/base-map/base-map.html" title="Create connection with many of the best behaviors in can-connect and hook it up to
a map.">can-connect/can/base-map/base-map</a></li>
<li><code>can-connect/can/super-map/super-map</code></li>
</ul>
<p>These have been moved into their own packages:</p>
<ul>
<li><a href="can-realtime-rest-model.html" title="Connect a type to a restful data source and automatically manage lists.">can-realtime-rest-model</a></li>
<li><a href="can-super-model.html" title="Connect a type to a restful data source, automatically manage lists, combine requests, and use a fall-through localstorage cache.">can-super-model</a></li>
</ul>
<h3>Replace <code>can-set-legacy</code> with <code>can-query-logic</code></h3>
<p>Instead of using <a href="can-set-legacy.html" title="can-set-legacy supports a legacy can-set API that creates a can-query-logic instance.">can-set-legacy</a>, use <a href="can-query-logic.html" title="Perform data queries and compare queries against each other. Provides logic useful for
data caching and real-time behavior.">can-query-logic</a> directly to configure
your query behavior. Read through the documentation on how to customize can-query-logic's documentation
<a href="can-query-logic.html#Configuration" title="Perform data queries and compare queries against each other. Provides logic useful for
data caching and real-time behavior.">here</a>.</p>
<p>In short:</p>
<ul>
<li>set.props.<a href="can-set-legacy.props.id.html" title="Defines the identify property.">id</a> is replaced by the <a href="can-define.types.identity.html" title="Specifies that the property uniquely identifies instances of the type.">identity</a> property behavior on a DefineMap.</li>
<li>set.props.<a href="can-set-legacy.props.boolean.html" title="Supports boolean properties.">boolean</a> is replaced by <code>{type: &quot;boolean&quot;}</code> on a DefineMap.</li>
<li>set.props.<a href="can-set-legacy.props.enum.html" title="">enum</a> is replaced by <a href="can-query-logic.makeEnum.html" title="Create a schema type that represents a finite set of values.">makeEnum</a>.</li>
<li><a href="can-set-legacy.props.offsetLimit.html" title="Supports sets that include a limit and offset.">offsetLimit</a>, <a href="can-set-legacy.props.rangeInclusive.html" title="Supports ranged properties.">rangeInclusive</a>, and <a href="can-set-legacy.props.sort.html" title="Defines the sortable property and behavior.">sort</a>
are replaced by <code>options.toQuery</code> and <code>options.toParams</code> values passed to <a href="can-query-logic.html" title="Perform data queries and compare queries against each other. Provides logic useful for
data caching and real-time behavior.">can-query-logic</a>.</li>
</ul>
<p>So instead of:</p>
<pre><code class="language-js">const todoAlgebra = new set.Algebra(

    // specify the unique identifier on data
    set.props.id( &quot;_id&quot; ),

    // specify that completed can be true, false or undefined
    set.props.boolean( &quot;completed&quot; ),

    set.props.enum(&quot;status&quot;,[&quot;new&quot;,&quot;assigned&quot;,&quot;complete&quot;])

    // specify properties that define pagination
    set.props.offsetLimit( &quot;offset&quot;, &quot;limit&quot; ),

    // specify the property that controls sorting
    set.props.sort( &quot;orderBy&quot; ),
);
</code></pre>
<p>You would have:</p>
<pre><code class="language-js">const Todo = DefineMap.extend({
    _id: {type: &quot;string&quot;, identity: true},
    complete: {type: &quot;boolean&quot;},
    status: QueryLogic.makeEnum([&quot;new&quot;,&quot;assigned&quot;,&quot;complete&quot;])
});

const todoQueryLogic = new QueryLogic(Todo,{
    toQuery(params){
        let query = {...params};
        if(query.orderBy != null) {
            query.sort = query.orderBy;
            delete query.orderBy;
        }
        if((&quot;offset&quot; in query) || (&quot;limit&quot; in query)) {
            query.page = {};
        }
        if(&quot;offset&quot; in query) {
            query.page.start = query.offset;
            delete query.offset;
        }
        if(&quot;limit&quot; in query) {
            query.page.end = (query.page.start || 0 ) + query.limit - 1;
            delete query.limit;
        }
        return query;
    },
    toParams(query){
        let params = {...query};
        if(params.orderBy != null) {
            params.sort = params.orderBy;
            delete params.orderBy;
        }
        if(params.page) {
            params.offset = params.page.start;
            params.limit = (params.page.end - params.page.start) + 1;
            delete params.page;
        }
        return params;
    }
})
</code></pre>
<h3>Space out your stache</h3>
<p>We've begun formatting our <a href="can-stache.html" title="Live binding templates.">can-stache</a> templates as follows:</p>
<pre><code class="language-html">{{# if(app.session) }}
    {{# if(app.session.isAdmin) }}
        &lt;li {{# is(app.page, 'users') }}class='active'{{/ is }}&gt;
            &lt;a href=&quot;{{ routeUrl(page='users') }}&quot;&gt;Users&lt;/a&gt;
        &lt;/li&gt;
    {{/ if }}
    &lt;li {{# is(app.page, 'account') }}class='active'{{/ is }}&gt;
        &lt;a href=&quot;{{ routeUrl(page='account') }}&quot;&gt;Account&lt;/a&gt;
    &lt;/li&gt;
    &lt;li&gt;
        &lt;a href=&quot;javascript://&quot; on:click=&quot;scope.vm.logout()&quot;&gt;Logout&lt;/a&gt;
    &lt;/li&gt;
{{ else }}

{{/ if }}
</code></pre>
<p>The following regular expressions and substitutions can be useful to clean
up your stache code:</p>
<ul>
<li><code>{{([^ #\/])</code> =&gt; <code>{{ $1</code> - Replaces <code>{{foo</code> with <code>{{ foo</code>.</li>
<li><code>{{([#\/\^])([^ ])</code> =&gt; <code>{{$1 $2</code> - Replaces <code>{{#foo</code> with <code>{{# foo</code>.</li>
<li><code>([^ ])}}</code> =&gt; <code>$1 }}</code> - Replaces <code>foo}}</code> with <code>foo }}</code>.</li>
</ul>
<p>Also, the following regular expression can help you find helper expressions like: <code>{{ foo bar }}</code> and
update them to call expressions like <code>{{ foo(bar) }}</code>:</p>
<ul>
<li><code>{{\s*([#\/\^])\s*\w+\s+[\w\.]+</code></li>
</ul>
<h3>Use for(of), let, and this</h3>
<p>In short, CanJS is migrating away from &quot;context&quot; lookup and to variable
lookup. This section talks about what this means and how to migrate your code.</p>
<p><a href="can-stache.html" title="Live binding templates.">can-stache</a> was originally based off <a href="http://mustache.github.io/">Mustache</a> and <a href="http://handlebarsjs.com/">Handlebars</a>.  As CanJS evolved, we recognized that their
implicit scope walking was a source of numerous bugs. For example, the following
might look up <code>name</code> on a <code>todo</code> or on the <code>ViewModel</code>:</p>
<pre><code class="language-js">Component.extend({
    view: `
        {{#each todosPromise.value}}
            &lt;li on:click=&quot;edit(this)&quot;&gt;{{name}}&lt;/li&gt;
        {{/each}}
    `,
    ViewModel: {
        get todosPromise(){ return Todo.getList(); },
        name: { type: &quot;string&quot;, default: &quot;ViewModel&quot; },
        edit(todo) { /* ... */ }
    }
})
</code></pre>
<p>For CanJS 4.0, we made scope walking explicit.  If <code>edit</code> should be read on the
<code>ViewModel</code>, it must be looked up with <code>../</code> as follows:</p>
<pre><code class="language-js">Component.extend({
    view: `
        {{#each todosPromise.value}}
            &lt;li on:click=&quot;../edit(this)&quot;&gt;{{name}}&lt;/li&gt;
        {{/each}}
    `,
    ViewModel: {
        get todosPromise(){ return Todo.getList(); },
        name: { type: &quot;string&quot;, default: &quot;ViewModel&quot; },
        edit(todo) { /* ... */ }
    }
})
</code></pre>
<p>While this explicitness prevents errors, it confusing to users. In fact,
context-based lookup is confusing to users altogether.  Values seem to come from
nowhere. It works more like JavaScript's <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/with">with</a>. Instead,
we are migrating towards a variable-based lookup approach. Thus, we've:</p>
<ul>
<li>Created two new helpers (<a href="can-stache.helpers.for-of.html" title="Loop through a list of values, keys in an object, or integers.">for(of)</a> and <a href="can-stache.helpers.let.html" title="Create a block-level variable.">let</a>) that
create variables.</li>
<li>Started using <code>{{this.key}}</code> to refer to values on the ViewModel instead of <code>{{key}}</code>.</li>
</ul>
<p>The component above should be updated to:</p>
<pre><code class="language-js">Component.extend({
    view: `
        {{# for todo of this.todosPromise.value }}
            &lt;li on:click=&quot;this.edit(todo)&quot;&gt;{{ todo.name }}&lt;/li&gt;
        {{/ for }}
    `,
    ViewModel: {
        get todosPromise(){ return Todo.getList(); },
        name: { type: &quot;string&quot;, default: &quot;ViewModel&quot; },
        edit(todo) { /* ... */ }
    }
})
</code></pre>
<p>Notice that <code>this</code> remains the <code>ViewModel</code> because <a href="can-stache.helpers.for-of.html" title="Loop through a list of values, keys in an object, or integers.">for(of)</a> doesn't
change the context, it only creates a <code>todo</code> variable.  Writing stache templates like this
makes what's going on immediately clear.</p>

</section>

  


<script type="text/javascript">
  window.docObject = {"src":{"path":"docs/can-guides/upgrade/migrating-to-canjs-5.md"},"description":"This guide walks you through the process to upgrade a 4.x app to CanJS 5.x. ","name":"migrate-5","title":"Migrating to CanJS 5","type":"page","parent":"guides/upgrade","order":2,"templateRender":["<%","%>"],"outline":{"depth":2},"comment":" ","pathToRoot":".."};
</script>
</article>
      
        <footer><p>CanJS is part of <a href="https://donejs.com" target="_blank">DoneJS</a>. Created and maintained by the core <a href="https://donejs.com/About.html#team" target="_blank">DoneJS team</a> and <a href="https://www.bitovi.com" target="_blank">Bitovi</a>. <strong>Currently 6.6.1.</strong></p>
</footer>
      

  </div>
  <div id="toc-sidebar" class="column">
    <nav>
      <h1 class="hide">On this page</h1>
    </nav>
    <div class="get-help">
      <h1>Get help</h1>
      <ul>
        <li><a href="https://www.bitovi.com/community/slack" target="_blank" class="icon-slack">Chat with us</a></li>
        <li><a href="https://github.com/canjs/canjs/issues/new" target="_blank" class="icon-github">File an issue</a></li>
        <li><a href="https://forums.bitovi.com/c/canjs" target="_blank" class="icon-forums">Ask questions</a></li>
        <li><a href="https://www.bitovi.com/blog/topic/canjs" target="_blank" class="icon-blog">Read latest news</a></li>
      </ul>
    </div>
  </div>
</div>

		
			<script>
				steal = {
				  	instantiated: {
				    	"bundles/bit-docs-site/static.css!$css" : null
				  	}
			  	};
			</script>
			<script type='text/javascript' data-main="bit-docs-site/static" src="./static/steal.production.js"></script>
		
		<script async defer src="https://buttons.github.io/buttons.js"></script>

		<!-- root-level elements with attributes necessary for the app -->
		<div path-prefix="."></div>

	</body>
</html>
